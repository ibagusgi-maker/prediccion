<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“ˆ Stock Prediction AI - Predictor con Datos Reales</title>
    
    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Ocultar scrollbars globalmente pero mantener funcionalidad */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }
        
        *::-webkit-scrollbar {
            display: none; /* Chrome, Safari y Opera */
        }
        
        /* ========================================
           VARIABLES DE TEMA (Gradiente Vibrante)
           ======================================== */
        :root {
            /* Tema Vibrante Azul-PÃºrpura */
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: rgba(102, 126, 234, 0.15);
            --bg-tertiary: rgba(118, 75, 162, 0.2);
            --bg-card: rgba(102, 126, 234, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-blue: #667eea;
            --accent-green: #26A69A;
            --accent-red: #EF5350;
            --shadow: rgba(0, 0, 0, 0.3);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-card: linear-gradient(145deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
        }
        
        [data-theme="light"] {
            /* Tema Claro (TradingView Light) */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FD;
            --bg-tertiary: #E0E3EB;
            --bg-card: #FFFFFF;
            --text-primary: #131722;
            --text-secondary: #787B86;
            --border-color: #E0E3EB;
            --accent-blue: #2962FF;
            --accent-green: #26A69A;
            --accent-red: #EF5350;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Trebuchet MS', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            /* Ocultar scrollbar pero mantener funcionalidad */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }
        
        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari y Opera */
        }
        
        /* Header Principal */
        .app-header {
            background: rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid rgba(102, 126, 234, 0.4);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }
        
        .app-logo-icon {
            font-size: 2em;
            animation: pulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(102, 126, 234, 0.6));
        }
        
        .app-logo-text h1 {
            font-size: 1.5em;
            font-weight: 600;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(102, 126, 234, 0.5);
        }
        
        .app-logo-text p {
            font-size: 0.75em;
            color: #b8b8b8;
            margin: 0;
            margin-top: 2px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
        }
        
        .app-header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(39, 174, 96, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            color: #27ae60;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }
        
        /* BotÃ³n de cambio de tema */
        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.3em;
        }
        
        .theme-toggle:hover {
            background: var(--accent-blue);
            transform: scale(1.05);
        }
        
        .theme-icon {
            transition: transform 0.3s ease;
        }
        
        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
            font-size: 0.85em;
        }
        
        .header-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header-stat-label {
            color: #95a5a6;
            font-size: 0.8em;
        }
        
        .header-stat-value {
            color: #3498db;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        /* Ticker Banner Superior */
        .ticker-banner {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            overflow: hidden;
            height: 50px;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .ticker-wrapper {
            display: flex;
            animation: scroll 60s linear infinite;
            white-space: nowrap;
        }
        
        .ticker-item {
            display: inline-flex;
            align-items: center;
            padding: 0 30px;
            font-size: 0.9em;
            border-right: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .ticker-icon {
            font-size: 1.3em;
            margin-right: 8px;
            filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.8));
        }
        
        .ticker-symbol {
            font-weight: bold;
            color: #667eea;
            margin-right: 8px;
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        
        .ticker-price {
            margin-right: 8px;
            color: #ffffff;
            font-weight: 500;
        }
        
        .ticker-change {
            font-size: 0.85em;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .ticker-change.positive {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.2);
        }
        
        .ticker-change.negative {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .ticker-wrapper:hover {
            animation-play-state: paused;
        }
        
        /* Carrusel de Mercados e Indicadores */
        .markets-carousel-section {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(102, 126, 234, 0.4);
            position: relative;
        }
        
        .markets-carousel-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.8), transparent);
            opacity: 1;
        }
        
        .markets-carousel-wrapper {
            display: flex;
            animation: scrollMarkets 40s linear infinite;
            padding: 15px 0;
        }
        
        .markets-carousel-wrapper:hover {
            animation-play-state: paused;
        }
        
        @keyframes scrollMarkets {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .market-card {
            min-width: 180px;
            margin: 0 10px;
            padding: 15px;
            background: rgba(20, 20, 40, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            flex-shrink: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        .market-card:hover {
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 35px rgba(102, 126, 234, 0.6);
            background: rgba(30, 30, 50, 0.8);
        }
        
        .market-card-icon {
            font-size: 1.5em;
            margin-bottom: 8px;
            font-weight: 700;
            color: #3498db;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .market-card-name {
            font-size: 0.85em;
            color: #95a5a6;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .market-card-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 5px;
        }
        
        .market-card-change {
            font-size: 0.9em;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .market-card-change.positive {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.2);
        }
        
        .market-card-change.negative {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .market-card-label {
            font-size: 0.75em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        /* Container principal con columnas redimensionables */
        .app-container {
            display: flex;
            height: calc(100vh - 120px); /* Header (60px) + Ticker (50px) + margen */
            position: relative;
        }
        
        .main-container {
            display: flex;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* Sidebar - Formulario + Resultados */
        .sidebar {
            background: rgba(102, 126, 234, 0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
            overflow-y: auto;
            height: 100%;
            min-width: 300px;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            /* Ocultar scrollbar pero mantener funcionalidad */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }
        
        .sidebar::-webkit-scrollbar {
            display: none; /* Chrome, Safari y Opera */
        }
        
        /* Divisor redimensionable */
        .resizer {
            width: 5px;
            background: #2c3e50;
            cursor: col-resize;
            position: relative;
            flex-shrink: 0;
            transition: background 0.2s ease;
        }
        
        .resizer:hover {
            background: #3498db;
        }
        
        .resizer::before {
            content: 'â‹®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: rgba(52, 152, 219, 0.5);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .resizer:hover::before {
            opacity: 1;
        }
        
        .resizer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 60px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .resizer:hover::after {
            opacity: 1;
        }
        
        .resizer.resizing {
            background: #3498db;
        }
        
        /* Main Content - Noticias e InformaciÃ³n */
        .main-content {
            background: var(--bg-primary);
            padding: 25px;
            overflow-y: auto;
            height: 100%;
            flex: 1;
            min-width: 300px;
            transition: background-color 0.3s ease;
            /* Ocultar scrollbar pero mantener funcionalidad */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }
        
        .main-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari y Opera */
        }
        
        /* Resultados en sidebar - mÃ¡s compactos */
        .sidebar .results-section {
            margin-top: 25px;
        }
        
        .sidebar .result-header {
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .sidebar .result-symbol {
            font-size: 1.8em;
        }
        
        .sidebar .prediction-card {
            padding: 20px;
            margin: 15px 0;
        }
        
        .sidebar .prediction-price {
            font-size: 2em;
        }
        
        .sidebar .analysis-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .sidebar .analysis-item {
            padding: 15px;
        }
        
        .sidebar .chart-container {
            margin-top: 20px;
            padding: 15px;
        }
        
        .sidebar .tradingview-widget {
            height: 350px;
        }
        
        .sidebar .factors-section {
            margin-top: 20px;
            padding: 15px;
        }
        
        .sidebar .factor-item {
            padding: 10px 12px;
            margin: 6px 0;
            font-size: 0.9em;
        }
        
        /* SecciÃ³n de herramientas en sidebar */
        .tools-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.4);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }
        
        .tools-title {
            font-size: 1.1em;
            color: #3498db;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .tool-item {
            background: rgba(102, 126, 234, 0.15);
            backdrop-filter: blur(5px);
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #667eea;
        }
        
        .tool-item:hover {
            background: rgba(102, 126, 234, 0.25);
            transform: translateX(5px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tool-item-title {
            font-weight: 600;
            color: #ecf0f1;
            margin-bottom: 5px;
        }
        
        .tool-item-desc {
            font-size: 0.85em;
            color: #95a5a6;
        }
        
        /* Tarjetas de Acciones Favoritas */
        .favorite-stock-card {
            background: linear-gradient(145deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            backdrop-filter: blur(5px);
            padding: 18px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.15);
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .favorite-stock-card:hover {
            background: linear-gradient(145deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%);
            border-color: rgba(102, 126, 234, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
        
        .favorite-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        .favorite-stock-card:hover .favorite-delete-btn {
            opacity: 1;
        }
        
        .favorite-delete-btn:hover {
            background: #e74c3c;
            transform: scale(1.1);
        }
        
        .prediction-form-container {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.4);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 25px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.2em;
            font-weight: 300;
            margin-bottom: 8px;
            color: #ecf0f1;
        }
        
        .header p {
            color: #bdc3c7;
            font-size: 1em;
        }
        
        .real-data-badge {
            background: linear-gradient(135deg, #4CAF50, #45A049);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
            font-size: 0.9em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes blink {
            0%, 80%, 100% { opacity: 0.3; }
            40% { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-section {
            animation: slideInUp 0.5s ease-out;
        }    
    
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-size: 1em;
            font-weight: 500;
            margin-bottom: 8px;
            color: #ecf0f1;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: #ecf0f1;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            color: #2c3e50;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            background: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* Autocompletado Styles */
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 2px solid #3498db;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .autocomplete-suggestions.show {
            display: block;
        }
        
        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #ecf0f1;
            transition: background-color 0.2s ease;
        }
        
        .suggestion-item:hover,
        .suggestion-item.selected {
            background: #3498db;
            color: white;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-symbol {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .suggestion-item:hover .suggestion-symbol,
        .suggestion-item.selected .suggestion-symbol {
            color: white;
        }
        
        .suggestion-name {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 2px;
        }
        
        .suggestion-item:hover .suggestion-name,
        .suggestion-item.selected .suggestion-name {
            color: #ecf0f1;
        }
        
        .suggestion-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }
        
        .suggestion-price {
            color: #27ae60;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .suggestion-item:hover .suggestion-price,
        .suggestion-item.selected .suggestion-price {
            color: #2ecc71;
        }
        
        .suggestion-market {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .suggestion-market.usa {
            background: #3498db;
        }
        
        .suggestion-market.usa-adr {
            background: #9b59b6;
            color: white;
        }
        
        .suggestion-market.argentina {
            background: #87ceeb;
            color: #2c3e50;
        }
        
        .suggestion-market.brasil {
            background: #27ae60;
        }
        
        /* Nota: .BA usa la clase argentina pero muestra "BYMA" */
        
        .no-suggestions {
            padding: 12px 16px;
            color: #7f8c8d;
            font-style: italic;
            text-align: center;
        }
        
        .form-select {
            width: 100%;
            padding: 14px 16px;
            background: rgba(118, 75, 162, 0.2);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 1em;
            color: #ffffff;
            outline: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }
        
        .form-select option {
            background: #2c3e50;
            color: #ffffff;
            padding: 8px;
        }
        
        .form-select optgroup {
            background: #1a1a2e;
            color: #667eea;
            font-weight: 700;
            font-size: 1em;
            padding: 8px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(118, 75, 162, 0.2);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 0.95em;
            color: #ffffff;
            outline: none;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        .form-textarea:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }
        
        .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
            opacity: 1;
        }
        
        .form-textarea::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .form-textarea::-moz-placeholder {
            color: rgba(255, 255, 255, 0.5);
            opacity: 1;
        }
        
        .form-textarea:-ms-input-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .predict-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            font-size: 1.15em;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5), 0 0 0 3px rgba(102, 126, 234, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .predict-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .predict-btn:hover::before {
            left: 100%;
        }
        
        .predict-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.7), 0 0 0 4px rgba(102, 126, 234, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .predict-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.98); }
        }
        
        .predict-btn:disabled {
            animation: buttonPulse 1.5s ease-in-out infinite;
        }
        
        .technical-analysis-section {
            margin-top: 25px;
            padding: 20px;
            background: #34495e;
            border-radius: 12px;
        }
        
        .technical-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .indicator-item {
            background: #2c3e50;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .indicator-name {
            color: #bdc3c7;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .indicator-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
        }
        
        .indicator-signal {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .signal-buy { background: #27ae60; color: white; }
        .signal-sell { background: #e74c3c; color: white; }
        .signal-neutral { background: #95a5a6; color: white; }
        
        .event-analysis-section {
            margin-top: 25px;
            padding: 20px;
            background: #34495e;
            border-radius: 12px;
        }
        
        .chart-container {
            margin-top: 25px;
            padding: 20px;
            background: #34495e;
            border-radius: 12px;
            text-align: center;
        }
        
        .tradingview-widget {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
        }      
  
        /* Resultados */
        .results-section {
            display: none;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: #34495e;
            border-radius: 15px;
        }
        
        .result-symbol {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .real-time-indicator {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            margin: 10px 0;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.7; }
        }
        
        .prediction-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .prediction-price {
            font-size: 2.8em;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .confidence-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .confidence-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #27ae60);
            border-radius: 4px;
            transition: width 1s ease;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .analysis-item {
            background: #34495e;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .analysis-label {
            color: #bdc3c7;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .analysis-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #ecf0f1;
        }       
 
        .recommendation-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 15px 0;
        }
        
        .rec-buy { background: #27ae60; color: white; }
        .rec-sell { background: #e74c3c; color: white; }
        .rec-hold { background: #f39c12; color: white; }
        
        .factors-section {
            margin-top: 25px;
            padding: 20px;
            background: #34495e;
            border-radius: 12px;
        }
        
        .factors-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .factor-item {
            background: #2c3e50;
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(52, 152, 219, 0.2);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }
        
        .loading-dots span {
            font-size: 1.5em;
            color: #3498db;
            margin: 0 5px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-section {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        .welcome-message {
            text-align: center;
            padding: 30px 20px;
            color: #bdc3c7;
        }
        
        .welcome-message h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        
        /* Welcome message en sidebar mÃ¡s compacto */
        .sidebar .welcome-message {
            display: none;
        }
        
        .data-source-info {
            background: #e8f5e8;
            color: #2c3e50;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        /* News Section */
        .news-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.4);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }
        
        .news-title {
            font-size: 1.4em;
            color: #ffffff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            text-shadow: 0 2px 10px rgba(102, 126, 234, 0.5);
        }
        
        .add-favorite-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: 700;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .add-favorite-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .news-item {
            background: #2c3e50;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .news-item:hover {
            background: #34495e;
            transform: translateX(5px);
        }
        
        .news-item-title {
            font-size: 1em;
            font-weight: 600;
            color: #ecf0f1;
            margin-bottom: 8px;
        }
        
        .news-item-source {
            font-size: 0.85em;
            color: #95a5a6;
            margin-bottom: 5px;
        }
        
        .news-item-time {
            font-size: 0.8em;
            color: #7f8c8d;
        }
        
        .news-loading {
            text-align: center;
            padding: 20px;
            color: #95a5a6;
        }
        
        /* News Slider Styles - Elegante */
        .news-slider-container {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            background: rgba(102, 126, 234, 0.15);
            backdrop-filter: blur(10px);
            min-height: 420px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }
        
        .news-slider-wrapper {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
        }
        
        .news-slide {
            min-width: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            background: transparent;
            border-radius: 16px;
            overflow: hidden;
        }
        
        .news-slide-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            position: relative;
        }
        
        .news-slide-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to top, var(--bg-card), transparent);
        }
        
        .news-slide-content {
            padding: 25px;
            flex: 1;
            background: transparent;
        }
        
        .news-slide-title {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            line-height: 1.4;
            transition: color 0.3s ease;
        }
        
        .news-slide-description {
            font-size: 0.95em;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        
        .news-slide-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .news-slide-source {
            font-size: 0.9em;
            color: #ffffff;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .news-slide-source::before {
            content: 'ðŸ“°';
            font-size: 1.1em;
        }
        
        .news-slide-time {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .news-slide-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background: var(--accent-blue);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(41, 98, 255, 0.3);
        }
        
        .news-slide-link:hover {
            background: #1E53E5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 98, 255, 0.4);
        }
        
        /* Botones del slider */
        .news-slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 2em;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .news-slider-btn:hover {
            background: rgba(52, 152, 219, 1);
            transform: translateY(-50%) scale(1.1);
        }
        
        .news-slider-prev {
            left: 10px;
        }
        
        .news-slider-next {
            right: 10px;
        }
        
        /* Indicadores de slide */
        .news-slider-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .news-slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #34495e;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .news-slider-dot.active {
            background: #3498db;
            width: 30px;
            border-radius: 5px;
        }
        
        .news-slider-dot:hover {
            background: #3498db;
        }
        
        /* Responsive Design */
        @media (max-width: 1023px) {
            .app-header {
                padding: 12px 20px;
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            
            .app-logo {
                flex-direction: column;
                gap: 8px;
            }
            
            .app-logo-text h1 {
                font-size: 1.3em;
            }
            
            .app-header-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .header-stats {
                gap: 15px;
            }
            
            .app-container {
                height: auto;
            }
            
            .main-container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100% !important;
                height: auto;
                padding: 20px;
            }
            
            .main-content {
                height: auto;
                padding: 20px;
            }
            
            .resizer {
                display: none;
            }
            
            .tools-section {
                margin-top: 20px;
            }
            
            .analysis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .ticker-banner {
                height: 45px;
            }
            
            .ticker-item {
                padding: 0 20px;
                font-size: 0.85em;
            }
            
            .market-card {
                min-width: 150px;
                padding: 12px;
            }
            
            .market-card-icon {
                font-size: 1.3em;
            }
            
            .market-card-value {
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 767px) {
            body {
                padding: 0;
            }
            
            .app-header {
                padding: 10px 15px;
            }
            
            .app-logo-icon {
                font-size: 1.5em;
            }
            
            .app-logo-text h1 {
                font-size: 1.1em;
            }
            
            .app-logo-text p {
                font-size: 0.7em;
            }
            
            .header-stats {
                display: none;
            }
            
            .live-indicator {
                font-size: 0.75em;
                padding: 4px 10px;
            }
            
            .sidebar, .main-content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.4em !important;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .technical-indicators {
                grid-template-columns: 1fr;
            }
            
            .tradingview-widget {
                height: 300px;
            }
            
            .tool-item {
                padding: 10px 12px;
            }
            
            /* Slider responsive */
            .news-slider-container {
                min-height: 450px;
            }
            
            .news-slide-image {
                height: 200px;
            }
            
            .news-slide-title {
                font-size: 1.1em;
            }
            
            .news-slide-description {
                font-size: 0.9em;
            }
            
            .news-slider-btn {
                width: 35px;
                height: 35px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Header Principal -->
    <div class="app-header">
        <div class="app-logo">
            <div class="app-logo-icon">ðŸ“ˆ</div>
            <div class="app-logo-text">
                <h1>Stock Prediction AI</h1>
                <p>AnÃ¡lisis Inteligente de Mercados Financieros</p>
            </div>
        </div>
        
        <div class="app-header-actions">
            <div class="header-stats">
                <div class="header-stat">
                    <span class="header-stat-label">Mercados</span>
                    <span class="header-stat-value">26</span>
                </div>
                <div class="header-stat">
                    <span class="header-stat-label">Fuentes</span>
                    <span class="header-stat-value">5</span>
                </div>
            </div>
            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
                <span class="theme-icon">ðŸŒ™</span>
            </button>
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>EN VIVO</span>
            </div>
        </div>
    </div>
    
    <!-- Ticker Banner -->
    <div class="ticker-banner">
        <div class="ticker-wrapper" id="tickerWrapper">
            <!-- Los tickers se cargarÃ¡n dinÃ¡micamente -->
        </div>
    </div>
    
    <!-- Container principal con columnas redimensionables -->
    <div class="app-container">
        <div class="main-container">
            <!-- Sidebar - Formulario -->
            <div class="sidebar" id="sidebar">
            <div class="prediction-form-container">
                <div class="header">
                    <h1 style="font-size: 1.6em;">ðŸ“ˆ Stock Prediction AI</h1>
                    <div class="real-data-badge" style="font-size: 0.8em; padding: 6px 12px;">
                        ðŸ”´ LIVE
                    </div>
                </div>
                
                <form id="predictionForm">
                <div class="form-group">
                    <label class="form-label">SÃ­mbolo BursÃ¡til</label>
                    <div class="autocomplete-container">
                        <input type="text" class="form-input" id="stockSymbol" placeholder="Ingresa sÃ­mbolo bursÃ¡til (Ej: AAPL, GOOGL, TSLA)" maxlength="10" required autocomplete="off">
                        <div class="autocomplete-suggestions" id="suggestions"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Marco Temporal</label>
                    <select class="form-select" id="timeframe">
                        <optgroup label="ðŸ“ˆ Trading IntradÃ­a">
                            <option value="5m">5 Minutos</option>
                            <option value="10m">10 Minutos</option>
                            <option value="15m">15 Minutos</option>
                            <option value="30m">30 Minutos</option>
                            <option value="1h">1 Hora</option>
                        </optgroup>
                        <optgroup label="ðŸ“Š Trading Diario">
                            <option value="1d" selected>1 DÃ­a</option>
                            <option value="1w">1 Semana</option>
                            <option value="1m">1 Mes</option>
                        </optgroup>
                        <optgroup label="ðŸ“ˆ InversiÃ³n a Largo Plazo">
                            <option value="3m">3 Meses</option>
                            <option value="6m">6 Meses</option>
                            <option value="1y">1 AÃ±o</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Evento Importante (Opcional)</label>
                    <textarea class="form-textarea" id="importantEvent" placeholder="Ej: Anuncio de resultados, cambio en polÃ­tica monetaria, etc."></textarea>
                </div>
                
                <button type="submit" class="predict-btn" id="predictBtn">
                    PREDECIR
                </button>
            </form>
            </div>
            
            <!-- Secciones de Loading, Error y Resultados (justo despuÃ©s del formulario) -->
            <div class="loading" id="loadingSection" style="padding: 30px 0; display: none;">
                <div class="loading-spinner"></div>
                <h3 style="font-size: 1.1em; margin-top: 15px;">ðŸŒ Analizando Mercado...</h3>
                <p id="loadingStep" style="font-size: 0.9em; margin-top: 10px;">Conectando con APIs financieras...</p>
                <div class="loading-dots" style="margin-top: 20px; text-align: center;">
                    <span style="animation: blink 1.4s infinite both; animation-delay: 0s;">â—</span>
                    <span style="animation: blink 1.4s infinite both; animation-delay: 0.2s;">â—</span>
                    <span style="animation: blink 1.4s infinite both; animation-delay: 0.4s;">â—</span>
                </div>
            </div>
            
            <div class="error-section" id="errorSection" style="margin-top: 20px; display: none;">
                <h3 style="font-size: 1.1em;">âŒ Error</h3>
                <p id="errorMessage" style="font-size: 0.9em;"></p>
            </div>
            
            <div class="results-section" id="resultsSection" style="display: none;">
                <!-- Resultados aquÃ­ -->
            </div>
            
            <!-- Separador visual -->
            <div style="height: 1px; background: linear-gradient(90deg, transparent, #3498db, transparent); margin: 25px 0;"></div>
            
            <!-- SecciÃ³n de Herramientas -->
            <div class="tools-section">
                <div class="tool-item" onclick="toggleBlackScholes()" style="border-left-color: #27ae60;">
                    <div class="tool-item-title">ðŸ“ˆ Black-Scholes</div>
                    <div class="tool-item-desc">Calculadora de opciones financieras</div>
                </div>
            </div>
            
            <!-- Calculadora Black-Scholes (oculta por defecto) -->
            <div class="tools-section" id="blackScholesCalc" style="margin-top: 20px; display: none;">
                <div class="tools-title">ðŸ“ˆ ValuaciÃ³n de Opciones (Black-Scholes)</div>
                <p style="font-size: 0.85em; color: #95a5a6; margin-top: 5px; line-height: 1.4;">
                    Calcula el valor teÃ³rico justo de opciones y compÃ¡ralo con el precio de mercado para saber si estÃ¡n caras o baratas.
                </p>
                
                <div style="margin-top: 15px;">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="form-label" style="font-size: 0.9em;">ðŸ’µ Precio Actual de la AcciÃ³n</label>
                        <input type="number" class="form-input" id="bs_spot" placeholder="Ej: 100" step="0.01" style="padding: 10px;">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="form-label" style="font-size: 0.9em;">ðŸŽ¯ Precio Strike (Ejercicio)</label>
                        <input type="number" class="form-input" id="bs_strike" placeholder="Ej: 105" step="0.01" style="padding: 10px;">
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="form-label" style="font-size: 0.9em;">ðŸ“… DÃ­as hasta Vencimiento</label>
                        <input type="number" class="form-input" id="bs_days" placeholder="Ej: 30" step="1" style="padding: 10px;" onchange="updateYearsFromDays()">
                        <div style="font-size: 0.8em; color: #95a5a6; margin-top: 5px;">
                            = <span id="bs_years_display">0</span> aÃ±os
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="form-label" style="font-size: 0.9em;">ðŸ“Š Volatilidad ImplÃ­cita (%)</label>
                        <input type="number" class="form-input" id="bs_volatility" placeholder="Ej: 25" step="0.1" style="padding: 10px;">
                        <div style="font-size: 0.8em; color: #95a5a6; margin-top: 5px;">
                            ðŸ’¡ TÃ­pico: 15-30% (acciones estables), 30-60% (volÃ¡tiles)
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="form-label" style="font-size: 0.9em;">ðŸ¦ Tasa Libre de Riesgo (% anual)</label>
                        <input type="number" class="form-input" id="bs_rate" placeholder="Ej: 5" step="0.1" style="padding: 10px;">
                        <div style="font-size: 0.8em; color: #95a5a6; margin-top: 5px;">
                            ðŸ’¡ USA: ~5%, Argentina: ~100%
                        </div>
                    </div>
                    
                    <!-- SecciÃ³n opcional para comparar con precio de mercado -->
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                        <label style="font-size: 0.9em; color: #3498db; font-weight: 600; display: block; margin-bottom: 10px;">
                            ðŸ” Comparar con Precio de Mercado (Opcional)
                        </label>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label class="form-label" style="font-size: 0.85em;">Precio Call en Mercado</label>
                            <input type="number" class="form-input" id="bs_market_call" placeholder="Opcional" step="0.01" style="padding: 8px;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="font-size: 0.85em;">Precio Put en Mercado</label>
                            <input type="number" class="form-input" id="bs_market_put" placeholder="Opcional" step="0.01" style="padding: 8px;">
                        </div>
                    </div>
                    
                    <button onclick="calculateBlackScholes()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #27ae60, #229954); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; margin-top: 10px;">
                        ðŸ’° Calcular Valor TeÃ³rico
                    </button>
                    
                    <div id="bs_results" style="margin-top: 15px; display: none;">
                        <!-- Resultados Call -->
                        <div style="background: #34495e; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <div style="font-size: 0.9em; color: #bdc3c7; margin-bottom: 8px;">ðŸ“ˆ Call Option - Valor TeÃ³rico</div>
                            <div style="font-size: 1.6em; font-weight: bold; color: #27ae60;" id="bs_call">$0.00</div>
                            <div id="bs_call_comparison" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <!-- Resultados Put -->
                        <div style="background: #34495e; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <div style="font-size: 0.9em; color: #bdc3c7; margin-bottom: 8px;">ðŸ“‰ Put Option - Valor TeÃ³rico</div>
                            <div style="font-size: 1.6em; font-weight: bold; color: #e74c3c;" id="bs_put">$0.00</div>
                            <div id="bs_put_comparison" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <!-- Greeks -->
                        <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin-top: 10px; font-size: 0.85em; color: #95a5a6;">
                            <strong style="color: #3498db;">ðŸ“Š Greeks (Sensibilidades):</strong><br><br>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <div>
                                    <strong>Delta Call:</strong> <span id="bs_delta_call">0.00</span><br>
                                    <span style="font-size: 0.8em;">Cambio por $1 en acciÃ³n</span>
                                </div>
                                <div>
                                    <strong>Delta Put:</strong> <span id="bs_delta_put">0.00</span><br>
                                    <span style="font-size: 0.8em;">Cambio por $1 en acciÃ³n</span>
                                </div>
                                <div>
                                    <strong>Gamma:</strong> <span id="bs_gamma">0.00</span><br>
                                    <span style="font-size: 0.8em;">AceleraciÃ³n del Delta</span>
                                </div>
                                <div>
                                    <strong>Vega:</strong> <span id="bs_vega">0.00</span><br>
                                    <span style="font-size: 0.8em;">Cambio por 1% volatilidad</span>
                                </div>
                                <div>
                                    <strong>Theta Call:</strong> <span id="bs_theta_call">0.00</span><br>
                                    <span style="font-size: 0.8em;">PÃ©rdida por dÃ­a</span>
                                </div>
                                <div>
                                    <strong>Theta Put:</strong> <span id="bs_theta_put">0.00</span><br>
                                    <span style="font-size: 0.8em;">PÃ©rdida por dÃ­a</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Info de Fuentes de Datos -->
            <div class="tools-section" style="margin-top: 20px;">
                <div class="tools-title">ðŸ“¡ Fuentes de Datos</div>
                <div style="font-size: 0.85em; color: #95a5a6; line-height: 1.8;">
                    <p>âœ… Yahoo Finance</p>
                    <p>âœ… Finnhub API</p>
                    <p>âœ… Alpha Vantage</p>
                    <p>âœ… TradingView Charts</p>
                    <p>âœ… Google Gemini AI</p>
                </div>
            </div>
        </div>
        
        <!-- Main Content - Noticias e InformaciÃ³n del Mercado -->
        <div class="main-content">
            <!-- Carrusel de Mercados e Indicadores -->
            <div class="markets-carousel-section">
                <div class="markets-carousel-wrapper" id="marketsCarousel">
                    <!-- Se cargarÃ¡ dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Slider de Noticias Financieras -->
            <div class="news-section" id="newsSection" style="margin-top: 0; padding: 0; background: transparent;">
                <!-- Slider Container -->
                <div class="news-slider-container">
                    <button class="news-slider-btn news-slider-prev" onclick="changeNewsSlide(-1)">â€¹</button>
                    
                    <div class="news-slider-wrapper" id="newsSliderWrapper">
                        <div class="news-loading" style="text-align: center; padding: 100px 20px;">
                            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>
                            <p>Cargando noticias...</p>
                        </div>
                    </div>
                    
                    <button class="news-slider-btn news-slider-next" onclick="changeNewsSlide(1)">â€º</button>
                </div>
                
                <!-- Indicadores de slide -->
                <div class="news-slider-dots" id="newsSliderDots"></div>
            </div>
            

            <!-- SecciÃ³n de Acciones Favoritas (Personalizable) -->
            <div class="news-section" style="margin-top: 25px;">
                <div class="news-title">
                    â­ Favoritas
                    <button onclick="showAddFavoriteModal()" class="add-favorite-btn">
                        + AGREGAR
                    </button>
                </div>
                <div id="favoritesContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 15px;">
                    <!-- Se cargarÃ¡ dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Modal para agregar favorito -->
            <div id="addFavoriteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
                <div style="background: #34495e; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
                    <h3 style="margin: 0 0 20px 0; color: #3498db;">â­ Agregar AcciÃ³n Favorita</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #ecf0f1; font-size: 0.9em;">SÃ­mbolo (Ej: AAPL, GGAL)</label>
                        <input type="text" id="favoriteSymbol" placeholder="AAPL" style="width: 100%; padding: 10px; border: none; border-radius: 8px; background: #2c3e50; color: white; font-size: 1em;" maxlength="10">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #ecf0f1; font-size: 0.9em;">Nombre (Ej: Apple Inc.)</label>
                        <input type="text" id="favoriteName" placeholder="Apple Inc." style="width: 100%; padding: 10px; border: none; border-radius: 8px; background: #2c3e50; color: white; font-size: 1em;">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="addFavoriteStock()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #27ae60, #229954); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                            Guardar
                        </button>
                        <button onclick="closeAddFavoriteModal()" style="flex: 1; padding: 12px; background: #95a5a6; border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                            Cancelar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Divisor redimensionable -->
            <div class="resizer" id="resizer"></div>
            
            <!-- Main Content sigue aquÃ­ (ya existe en el cÃ³digo) -->
        </div>
    </div>

    <script>
        // ðŸ¤– CONFIGURACIÃ“N GEMINI AI (Reemplaza con tu API key para anÃ¡lisis real)
        window.GEMINI_API_KEY = 'AIzaSyDGtCmdZzEFGG9vu5GzznUl8ELsoV8GYzs';
        
        // ðŸ“Š CONFIGURACIÃ“N ALPHA VANTAGE (Para mejor cobertura de acciones argentinas)
        window.ALPHA_VANTAGE_KEY = '59W38J85ZM8MGIIZ'; // Reemplazar con tu API key gratuita
        
        // Para anÃ¡lisis IA real con Gemini:
        // 1. Ve a https://makersuite.google.com/app/apikey
        // 2. Crea una nueva API key gratuita
        // 3. Reemplaza 'TU_GEMINI_API_KEY_AQUI' con tu key real
        // 4. Â¡Disfruta de predicciones sÃºper precisas con IA real!
        
        // Para mejor cobertura de acciones argentinas con Alpha Vantage:
        // 1. Ve a https://www.alphavantage.co/support/#api-key
        // 2. ObtÃ©n tu API key gratuita (5 llamadas/minuto)
        // 3. Reemplaza 'demo' con tu key real
        // 4. Mejora la cobertura de acciones argentinas locales
        
        // ðŸ‡¦ðŸ‡· ACCIONES ARGENTINAS:
        // El sistema usa automÃ¡ticamente Yahoo Finance con sufijo .BA,
        // Alpha Vantage, y web scraping de Bolsar.info para obtener
        // precios reales de acciones argentinas del MERVAL
        
        // IntegraciÃ³n de la clase RealTimeStockAPI del stock-real-time.html
        class RealTimeStockAPI {
            constructor() {
                this.methods = [
                    { name: 'Yahoo Finance .BA', func: this.fetchYahooBA, priority: 1 },
                    { name: 'BYMA Data Oficial', func: this.fetchBYMAData, priority: 2 },
                    { name: 'Yahoo Proxy CORS', func: this.fetchWithProxy, priority: 3 },
                    { name: 'Yahoo Proxy Alternativo', func: this.fetchWithProxyAlt, priority: 4 },
                    { name: 'Bolsar.info Scraping', func: this.fetchBolsar, priority: 5 },
                    { name: 'Ãmbito Financiero Scraping', func: this.fetchAmbito, priority: 6 },
                    { name: 'Finnhub Direct', func: this.fetchFinnhubDirect, priority: 7 }
                ];
                this.cache = new Map(); // Cache para evitar llamadas repetidas
                this.cacheTimeout = 60000; // 60 segundos (aumentado)
                
                // Advertencia para acciones argentinas
                this.argentineWarningShown = false;
            }
            
            async getRealPrice(symbol) {
                console.log(`ðŸ” Buscando precio real para ${symbol}...`);
                
                // Verificar cache primero
                const cacheKey = symbol.toUpperCase();
                const cached = this.cache.get(cacheKey);
                if (cached && (Date.now() - cached.timestamp) < this.cacheTimeout) {
                    console.log(`ðŸ“‹ Usando datos en cache para ${symbol}: $${cached.price}`);
                    return cached;
                }
                
                for (let method of this.methods) {
                    try {
                        console.log(`ðŸ“¡ Intentando: ${method.name}`);
                        const data = await method.func.call(this, symbol);
                        
                        // ValidaciÃ³n mejorada
                        if (this.isValidPriceData(data, symbol)) {
                            console.log(`âœ… Ã‰xito con ${method.name}: $${data.price}`);
                            data.method = method.name;
                            
                            // Guardar en cache
                            const cacheKey = symbol.toUpperCase();
                            this.cache.set(cacheKey, data);
                            
                            return data;
                        } else {
                            console.log(`âš ï¸ ${method.name} devolviÃ³ datos invÃ¡lidos:`, data?.price);
                        }
                    } catch (error) {
                        console.log(`âŒ ${method.name} fallÃ³:`, error.message);
                    }
                }
                
                // Fallback para acciones argentinas y otras
                if (this.isArgentineStock(symbol)) {
                    console.warn(`âš ï¸ IMPORTANTE: ${symbol} es una acciÃ³n argentina del MERVAL`);
                    console.warn(`âš ï¸ Las APIs internacionales no tienen datos de acciones argentinas locales`);
                    console.warn(`âš ï¸ Mostrando datos simulados - Para precios reales, consulta IOL Invertir Online o Bolsar`);
                }
                console.log(`ðŸ”„ Usando datos simulados para ${symbol}...`);
                return await this.generateFallbackData(symbol);
            }
            
            // ValidaciÃ³n mejorada de datos de precio
            isValidPriceData(data, symbol) {
                // Verificar que data existe y tiene precio
                if (!data || data.price === undefined || data.price === null) {
                    console.log(`âŒ ValidaciÃ³n fallÃ³: data o price es null/undefined`);
                    return false;
                }
                
                const price = parseFloat(data.price);
                
                // Verificar que el precio sea un nÃºmero vÃ¡lido
                if (isNaN(price) || !isFinite(price) || price <= 0) {
                    console.log(`âŒ ValidaciÃ³n fallÃ³: precio invÃ¡lido (${price})`);
                    return false;
                }
                
                // Verificar que no sea un precio absurdo (muy cercano a 0)
                if (price < 0.001) {
                    console.log(`âŒ ValidaciÃ³n fallÃ³: precio demasiado bajo (${price})`);
                    return false;
                }
                
                // Verificar rangos razonables por tipo de activo
                if (this.isArgentineStock(symbol)) {
                    // Acciones argentinas: entre $0.10 y $10,000
                    if (price < 0.10 || price > 10000) {
                        console.log(`âŒ ValidaciÃ³n fallÃ³: precio fuera de rango argentino (${price})`);
                        return false;
                    }
                } else {
                    // Acciones USA/internacionales: entre $0.01 y $50,000
                    if (price < 0.01 || price > 50000) {
                        console.log(`âŒ ValidaciÃ³n fallÃ³: precio fuera de rango USA (${price})`);
                        return false;
                    }
                }
                
                // Verificar que tenga nombre vÃ¡lido
                if (!data.name || data.name.trim() === '') {
                    console.log(`âš ï¸ Advertencia: sin nombre de compaÃ±Ã­a`);
                }
                
                console.log(`âœ… ValidaciÃ³n exitosa: $${price} para ${symbol}`);
                return true;
            }
            
            // Detectar si es una acciÃ³n argentina (incluye ADRs y locales)
            isArgentineStock(symbol) {
                const argentineStocks = ['GGAL', 'PAM', 'BMA', 'SUPV', 'CRESY', 'YPF', 'TEO', 'TX', 'ARCO', 'CEPU', 'LOMA', 'IRSA', 'DESP', 'EDN', 'BBAR', 'COME', 'MIRG', 'TGSU2', 'TRAN', 'ALUA', 'TXAR', 'VALO', 'CGPA2', 'TGNO4', 'PAMP', 'RICH', 'CRES', 'BHIP', 'BYMA', 'HAVA', 'INVJ', 'LEDE', 'LONG', 'METR', 'MOLA', 'MORI', 'OEST', 'POLL', 'RIGO', 'ROSE', 'SAMI', 'SEMI', 'TECO2', 'FERR', 'FIPL', 'GARO', 'GCLA', 'GRIM', 'INTR', 'CAPX', 'CARC', 'CTIO', 'DGCU2', 'DYCASA', 'ESME', 'GBAN', 'HARG'];
                return argentineStocks.includes(symbol.toUpperCase()) || symbol.toUpperCase().endsWith('.BA');
            }
            
            // Detectar si es un ADR argentino (cotiza en NYSE, no necesita .BA)
            isArgentineADR(symbol) {
                const adrs = ['GGAL', 'BMA', 'BBAR', 'SUPV', 'YPF', 'TEO', 'TX', 'PAM', 'CEPU', 'LOMA', 'CRESY', 'EDN', 'IRSA', 'MELI', 'GLOB', 'DESP'];
                return adrs.includes(symbol.toUpperCase()) && !symbol.includes('.BA');
            }
            
            // Detectar si necesita agregar .BA
            needsBAsufix(symbol) {
                // Si ya tiene .BA, no necesita
                if (symbol.includes('.BA')) return false;
                
                // Si es un ADR, no necesita .BA
                if (this.isArgentineADR(symbol)) return false;
                
                // Si es una acciÃ³n argentina local, necesita .BA
                return this.isArgentineStock(symbol);
            }
            
            // Mapear tickers a los correctos de Yahoo Finance Argentina
            getYahooBASymbol(symbol) {
                // Mapeo de tickers que tienen nombres diferentes en Yahoo Finance
                const yahooMapping = {
                    'BMA.BA': 'BMAP.BA',      // Banco Macro
                    'SUPV.BA': 'SUPV.BA',     // Supervielle
                    'GGAL.BA': 'GGAL.BA',     // Galicia
                    'PAMP.BA': 'PAMP.BA',     // Pampa
                    'YPFD.BA': 'YPFD.BA',     // YPF
                    'TECO2.BA': 'TECO2.BA',   // Telecom
                    'TXAR.BA': 'TXAR.BA',     // Ternium
                    'ALUA.BA': 'ALUA.BA',     // Aluar
                    'LOMA.BA': 'LOMA.BA',     // Loma Negra
                    'CEPU.BA': 'CEPU.BA',     // Central Puerto
                    'EDN.BA': 'EDN.BA',       // Edenor
                    'COME.BA': 'COME.BA',     // Comafi
                    'BHIP.BA': 'BHIP.BA',     // Banco Hipotecario
                    'BYMA.BA': 'BYMA.BA',     // BYMA
                    'TRAN.BA': 'TRAN.BA',     // Transener
                    'TGSU2.BA': 'TGSU2.BA',   // TGS
                    'TGNO4.BA': 'TGNO4.BA',   // TGN
                    'CRES.BA': 'CRES.BA',     // Cresud
                    'IRSA.BA': 'IRSA.BA'      // IRSA
                };
                
                return yahooMapping[symbol] || symbol;
            }
            
            // Helper para fetch con timeout
            async fetchWithTimeout(url, options = {}, timeout = 5000) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);
                
                try {
                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    return response;
                } catch (error) {
                    clearTimeout(timeoutId);
                    if (error.name === 'AbortError') {
                        throw new Error('Request timeout');
                    }
                    throw error;
                }
            }

            async fetchYahooBA(symbol) {
                // Solo para acciones argentinas locales que necesitan .BA
                if (!this.needsBAsufix(symbol)) {
                    throw new Error('Yahoo .BA solo para acciones locales argentinas');
                }
                
                const baSymbol = symbol.includes('.BA') ? symbol : `${symbol}.BA`;
                const yahooSymbol = this.getYahooBASymbol(baSymbol);
                
                // Para BMA, intentar mÃºltiples variantes
                const symbolVariants = [yahooSymbol];
                if (symbol.toUpperCase().includes('BMA')) {
                    symbolVariants.push('BMAP.BA', 'BMA.BCBA', 'BMAP.BCBA');
                }
                
                console.log(`ðŸ” Yahoo .BA: ${symbol} â†’ intentando ${symbolVariants.length} variantes`);
                
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                
                // Intentar cada variante
                for (const variant of symbolVariants) {
                    try {
                        console.log(`  â†’ Probando: ${variant}`);
                        const targetUrl = encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${variant}`);
                        
                        const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 8000);
                        
                        if (!response.ok) {
                            continue; // Probar siguiente variante
                        }
                        
                        const data = await response.json();
                        
                        if (!data.chart || !data.chart.result || !data.chart.result[0]) {
                            continue; // Probar siguiente variante
                        }
                        
                        const result = data.chart.result[0];
                        const meta = result.meta;
                        
                        // Validar que tengamos precio vÃ¡lido
                        const price = meta.regularMarketPrice || meta.previousClose;
                        if (!price || price <= 0) {
                            continue; // Probar siguiente variante
                        }
                        
                        console.log(`  âœ… Ã‰xito con variante: ${variant}`);
                        
                        const previousClose = meta.previousClose || price;
                        const change = price - previousClose;
                        const changePercent = previousClose > 0 ? (change / previousClose) * 100 : 0;
                
                        return {
                            symbol: symbol,
                            name: meta.longName || meta.shortName || symbol,
                            price: price,
                            change: change,
                            changePercent: changePercent,
                            volume: meta.regularMarketVolume || 0,
                            marketCap: meta.marketCap || 0,
                            currency: 'ARS',
                            timestamp: Date.now(),
                            source: `Yahoo Finance Argentina (${variant})`,
                            isRealTime: true
                        };
                    } catch (variantError) {
                        console.log(`  âŒ Variante ${variant} fallÃ³: ${variantError.message}`);
                        continue;
                    }
                }
                
                // Si todas las variantes fallaron
                throw new Error('Yahoo .BA: todas las variantes fallaron');
            }

            async fetchBYMAData(symbol) {
                // BYMA Data - Fuente oficial de la Bolsa de Buenos Aires
                if (!this.needsBAsufix(symbol)) {
                    throw new Error('BYMA Data solo para acciones locales argentinas');
                }
                
                // Remover .BA para la bÃºsqueda
                const cleanSymbol = symbol.replace('.BA', '').toUpperCase();
                
                console.log(`ðŸ” BYMA Data: ${symbol} â†’ ${cleanSymbol}`);
                
                try {
                    // Intentar primero con la API interna de BYMA (si existe)
                    // BYMA suele tener endpoints JSON para sus datos
                    const apiUrls = [
                        `https://open.bymadata.com.ar/vanoms-be-core/rest/api/bymadata/free/cotizacion/serieshistoricas/${cleanSymbol}/acciones/1`,
                        `https://open.bymadata.com.ar/vanoms-be-core/rest/api/bymadata/free/cotizacion/${cleanSymbol}`,
                        `https://api.bymadata.com.ar/v1/cotizaciones/${cleanSymbol}`
                    ];
                    
                    // Intentar cada endpoint
                    for (const apiUrl of apiUrls) {
                        try {
                            const proxyUrl = 'https://api.allorigins.win/raw?url=';
                            const targetUrl = encodeURIComponent(apiUrl);
                            
                            const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 8000);
                    
                            if (response.ok) {
                                const data = await response.json();
                                
                                // Intentar extraer precio de respuesta JSON
                                const price = data.vUltimo || data.ultimo || data.price || data.ultimoPrecio || 
                                            data.data?.vUltimo || data.data?.ultimo;
                                
                                if (price && price > 0) {
                                    console.log(`âœ… BYMA API JSON funcionÃ³: ${apiUrl}`);
                                    
                                    const changePercent = data.variacionPorcentual || data.variacion || 
                                                        data.data?.variacionPorcentual || 0;
                                    const volume = data.cantidadOperaciones || data.volumen || 
                                                 data.data?.cantidadOperaciones || 0;
                                    
                                    return {
                                        symbol: symbol,
                                        name: await this.getCompanyName(symbol),
                                        price: parseFloat(price),
                                        change: (parseFloat(price) * parseFloat(changePercent)) / 100,
                                        changePercent: parseFloat(changePercent),
                                        volume: parseInt(volume) || 0,
                                        marketCap: 0,
                                        currency: 'ARS',
                                        timestamp: Date.now(),
                                        source: 'BYMA Data API (Bolsa Oficial)',
                                        isRealTime: true
                                    };
                                }
                            }
                        } catch (apiError) {
                            console.log(`âš ï¸ BYMA API ${apiUrl} fallÃ³: ${apiError.message}`);
                            continue;
                        }
                    }
                    
                    // Si las APIs JSON fallan, intentar scraping HTML
                    console.log(`ðŸ”„ Intentando scraping HTML de BYMA...`);
                    const proxyUrl = 'https://api.allorigins.win/get?url=';
                    const targetUrl = encodeURIComponent(`https://open.bymadata.com.ar/#/especies/detalle/${cleanSymbol}`);
                    
                    const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 10000);
                    
                    if (!response.ok) {
                        throw new Error('BYMA Data no disponible');
                    }
                    
                    const data = await response.json();
                    const html = data.contents;
                    
                    // Patrones para extraer datos de BYMA Data
                    const pricePatterns = [
                        /Ãšltimo[:\s]*<[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /Cierre[:\s]*<[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /precio[:\s]*<[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /"price"[:\s]*"?\$?\s*([0-9.,]+)"?/i,
                        /"ultimo"[:\s]*"?\$?\s*([0-9.,]+)"?/i,
                        /data-price="([0-9.,]+)"/i
                    ];
                    
                    let priceMatch = null;
                    for (const pattern of pricePatterns) {
                        priceMatch = html.match(pattern);
                        if (priceMatch && priceMatch[1]) {
                            console.log(`âœ“ BYMA Data: Precio encontrado con patrÃ³n`);
                            break;
                        }
                    }
                    
                    if (!priceMatch || !priceMatch[1]) {
                        throw new Error('No se pudo extraer precio de BYMA Data');
                    }
                    
                    // Convertir precio (BYMA usa punto para miles y coma para decimales)
                    const priceStr = priceMatch[1].replace(/\./g, '').replace(',', '.');
                    const price = parseFloat(priceStr);
                    
                    if (isNaN(price) || price <= 0) {
                        throw new Error(`BYMA Data: precio invÃ¡lido (${price})`);
                    }
                    
                    // Intentar extraer variaciÃ³n
                    const changePatterns = [
                        /VariaciÃ³n[:\s]*<[^>]*>([+-]?[0-9.,]+)%/i,
                        /var[:\s]*<[^>]*>([+-]?[0-9.,]+)%/i,
                        /"variacion"[:\s]*"?([+-]?[0-9.,]+)"?/i,
                        /data-change="([+-]?[0-9.,]+)"/i
                    ];
                    
                    let changeMatch = null;
                    for (const pattern of changePatterns) {
                        changeMatch = html.match(pattern);
                        if (changeMatch && changeMatch[1]) break;
                    }
                    
                    const changePercent = changeMatch ? parseFloat(changeMatch[1].replace(',', '.')) : 0;
                    const change = (price * changePercent) / 100;
                    
                    // Intentar extraer volumen
                    const volumePatterns = [
                        /Volumen[:\s]*<[^>]*>\s*([0-9.,]+)/i,
                        /"volumen"[:\s]*"?([0-9.,]+)"?/i,
                        /data-volume="([0-9.,]+)"/i
                    ];
                    
                    let volumeMatch = null;
                    for (const pattern of volumePatterns) {
                        volumeMatch = html.match(pattern);
                        if (volumeMatch && volumeMatch[1]) break;
                    }
                    
                    const volume = volumeMatch ? parseInt(volumeMatch[1].replace(/\./g, '').replace(',', '')) : 0;
                    
                    return {
                        symbol: symbol,
                        name: await this.getCompanyName(symbol),
                        price: price,
                        change: change,
                        changePercent: changePercent,
                        volume: volume,
                        marketCap: 0,
                        currency: 'ARS',
                        timestamp: Date.now(),
                        source: 'BYMA Data (Bolsa Oficial)',
                        isRealTime: true
                    };
                } catch (error) {
                    console.log(`âŒ BYMA Data scraping fallÃ³: ${error.message}`);
                    throw error;
                }
            }

            async fetchWithProxy(symbol) {
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const targetUrl = encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`);
                
                const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 8000);
                
                if (!response.ok) {
                    throw new Error('Proxy CORS fallÃ³');
                }
                
                const data = await response.json();
                
                if (!data.chart || !data.chart.result || !data.chart.result[0]) {
                    throw new Error('Datos invÃ¡lidos de Yahoo Finance');
                }
                
                const result = data.chart.result[0];
                const meta = result.meta;
                
                // Validar que tengamos precio vÃ¡lido
                const price = meta.regularMarketPrice || meta.previousClose;
                if (!price || price <= 0) {
                    throw new Error(`Yahoo Proxy: precio invÃ¡lido (${price})`);
                }
                
                const previousClose = meta.previousClose || price;
                const change = price - previousClose;
                const changePercent = previousClose > 0 ? (change / previousClose) * 100 : 0;
                
                return {
                    symbol: symbol,
                    name: meta.longName || meta.shortName || symbol,
                    price: price,
                    change: change,
                    changePercent: changePercent,
                    volume: meta.regularMarketVolume || 0,
                    marketCap: meta.marketCap || 0,
                    currency: meta.currency || 'USD',
                    timestamp: Date.now(),
                    source: 'Yahoo Finance (via Proxy)',
                    isRealTime: true
                };
            }
            
            async fetchWithProxyAlt(symbol) {
                // Proxy alternativo mÃ¡s confiable
                const proxyUrl = 'https://corsproxy.io/?';
                const targetUrl = encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`);
                
                const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 8000);
                
                if (!response.ok) {
                    throw new Error('Proxy alternativo fallÃ³');
                }
                
                const data = await response.json();
                
                if (!data.chart || !data.chart.result || !data.chart.result[0]) {
                    throw new Error('Datos invÃ¡lidos del proxy alternativo');
                }
                
                const result = data.chart.result[0];
                const meta = result.meta;
                
                // Validar que tengamos precio vÃ¡lido
                const price = meta.regularMarketPrice || meta.previousClose;
                if (!price || price <= 0) {
                    throw new Error(`Proxy Alt: precio invÃ¡lido (${price})`);
                }
                
                const previousClose = meta.previousClose || price;
                const change = price - previousClose;
                const changePercent = previousClose > 0 ? (change / previousClose) * 100 : 0;
                
                return {
                    symbol: symbol,
                    name: meta.longName || meta.shortName || symbol,
                    price: price,
                    change: change,
                    changePercent: changePercent,
                    volume: meta.regularMarketVolume || 0,
                    marketCap: meta.marketCap || 0,
                    currency: meta.currency || 'USD',
                    timestamp: Date.now(),
                    source: 'Yahoo Finance (Proxy Alternativo)',
                    isRealTime: true
                };
            }

            async fetchBolsar(symbol) {
                // Web scraping de Bolsar.info para acciones argentinas locales
                if (!this.needsBAsufix(symbol)) {
                    throw new Error('Bolsar solo para acciones locales argentinas');
                }
                
                // Remover .BA si existe para la bÃºsqueda en Bolsar
                const cleanSymbol = symbol.replace('.BA', '');
                
                try {
                    const proxyUrl = 'https://api.allorigins.win/get?url=';
                    const targetUrl = encodeURIComponent(`https://bolsar.info/Cotizaciones.php?Ticker=${cleanSymbol}`);
                    
                    const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 10000);
                    
                    if (!response.ok) {
                        throw new Error('Bolsar.info no disponible');
                    }
                    
                    const data = await response.json();
                    const html = data.contents;
                    
                    // MÃºltiples patrones para extraer precio (mÃ¡s robusto)
                    const pricePatterns = [
                        /class="precio[^"]*"[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /Ãšltimo[:\s]*\$?\s*([0-9.,]+)/i,
                        /Precio[:\s]*\$?\s*([0-9.,]+)/i,
                        /Cierre[:\s]*\$?\s*([0-9.,]+)/i,
                        /<td[^>]*>\s*\$?\s*([0-9.,]+)\s*<\/td>/i,
                        /valor[:\s]*\$?\s*([0-9.,]+)/i
                    ];
                    
                    let priceMatch = null;
                    for (const pattern of pricePatterns) {
                        priceMatch = html.match(pattern);
                        if (priceMatch && priceMatch[1]) break;
                    }
                    
                    if (!priceMatch || !priceMatch[1]) {
                        throw new Error('No se pudo extraer precio de Bolsar');
                    }
                    
                    const priceStr = priceMatch[1].replace(/\./g, '').replace(',', '.');
                    const price = parseFloat(priceStr);
                    
                    if (isNaN(price) || price <= 0) {
                        throw new Error(`Bolsar: precio invÃ¡lido (${price})`);
                    }
                    
                    // Intentar extraer variaciÃ³n
                    const changeMatch = html.match(/VariaciÃ³n[^0-9-]*([+-]?[0-9.,]+)%/i);
                    const changePercent = changeMatch ? parseFloat(changeMatch[1].replace(',', '.')) : 0;
                    const change = (price * changePercent) / 100;
                    
                    return {
                        symbol: symbol,
                        name: await this.getCompanyName(symbol),
                        price: price,
                        change: change,
                        changePercent: changePercent,
                        volume: 0,
                        marketCap: 0,
                        currency: 'ARS',
                        timestamp: Date.now(),
                        source: 'Bolsar.info (Web Scraping)',
                        isRealTime: true
                    };
                } catch (error) {
                    console.log(`âŒ Bolsar scraping fallÃ³: ${error.message}`);
                    throw error;
                }
            }

            async fetchAmbito(symbol) {
                // Web scraping de Ãmbito Financiero para acciones argentinas
                if (!this.needsBAsufix(symbol)) {
                    throw new Error('Ãmbito solo para acciones locales argentinas');
                }
                
                // Remover .BA para la bÃºsqueda
                const cleanSymbol = symbol.replace('.BA', '');
                
                try {
                    const proxyUrl = 'https://api.allorigins.win/get?url=';
                    const targetUrl = encodeURIComponent(`https://www.ambito.com/contenidos/${cleanSymbol.toLowerCase()}.html`);
                    
                    const response = await this.fetchWithTimeout(proxyUrl + targetUrl, {}, 10000);
                    
                    if (!response.ok) {
                        throw new Error('Ãmbito Financiero no disponible');
                    }
                    
                    const data = await response.json();
                    const html = data.contents;
                    
                    // Patrones para extraer precio de Ãmbito
                    const pricePatterns = [
                        /data-indice="[^"]*"[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /class="value[^"]*"[^>]*>\s*\$?\s*([0-9.,]+)/i,
                        /Ãšltimo[:\s]*\$?\s*([0-9.,]+)/i,
                        /Cierre[:\s]*\$?\s*([0-9.,]+)/i,
                        /<span[^>]*class="[^"]*precio[^"]*"[^>]*>\s*\$?\s*([0-9.,]+)/i
                    ];
                    
                    let priceMatch = null;
                    for (const pattern of pricePatterns) {
                        priceMatch = html.match(pattern);
                        if (priceMatch && priceMatch[1]) break;
                    }
                    
                    if (!priceMatch || !priceMatch[1]) {
                        throw new Error('No se pudo extraer precio de Ãmbito');
                    }
                    
                    // Convertir precio (Ãmbito usa punto para miles y coma para decimales)
                    const priceStr = priceMatch[1].replace(/\./g, '').replace(',', '.');
                    const price = parseFloat(priceStr);
                    
                    if (isNaN(price) || price <= 0) {
                        throw new Error(`Ãmbito: precio invÃ¡lido (${price})`);
                    }
                    
                    // Intentar extraer variaciÃ³n
                    const changePatterns = [
                        /VariaciÃ³n[:\s]*([+-]?[0-9.,]+)%/i,
                        /var[:\s]*([+-]?[0-9.,]+)%/i,
                        /class="[^"]*variacion[^"]*"[^>]*>([+-]?[0-9.,]+)%/i
                    ];
                    
                    let changeMatch = null;
                    for (const pattern of changePatterns) {
                        changeMatch = html.match(pattern);
                        if (changeMatch && changeMatch[1]) break;
                    }
                    
                    const changePercent = changeMatch ? parseFloat(changeMatch[1].replace(',', '.')) : 0;
                    const change = (price * changePercent) / 100;
                    
                    return {
                        symbol: symbol,
                        name: await this.getCompanyName(symbol),
                        price: price,
                        change: change,
                        changePercent: changePercent,
                        volume: 0,
                        marketCap: 0,
                        currency: 'ARS',
                        timestamp: Date.now(),
                        source: 'Ãmbito Financiero (Web Scraping)',
                        isRealTime: true
                    };
                } catch (error) {
                    console.log(`âŒ Ãmbito scraping fallÃ³: ${error.message}`);
                    throw error;
                }
            }

            async fetchFinnhubDirect(symbol) {
                const token = 'ctqhqj1r01qhqj1r01qg'; // Token mÃ¡s confiable
                
                const response = await this.fetchWithTimeout(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${token}`, {}, 5000);
                
                if (!response.ok) {
                    throw new Error('Finnhub API error');
                }
                
                const data = await response.json();
                
                // Validar precio actual
                if (!data.c || data.c <= 0 || isNaN(data.c)) {
                    throw new Error(`Finnhub: precio invÃ¡lido (${data.c})`);
                }
                
                // Validar que no sea un precio de mercado cerrado (0)
                if (data.c === 0 && data.pc > 0) {
                    console.log(`âš ï¸ Finnhub: mercado cerrado, usando precio de cierre anterior`);
                    data.c = data.pc;
                }
                
                const change = data.d || 0;
                const changePercent = data.dp || 0;
                
                return {
                    symbol: symbol,
                    name: await this.getCompanyName(symbol),
                    price: data.c,
                    change: change,
                    changePercent: changePercent,
                    previousClose: data.pc || data.c,
                    high: data.h || data.c,
                    low: data.l || data.c,
                    volume: 'N/A',
                    currency: 'USD',
                    timestamp: Date.now(),
                    source: 'Finnhub API',
                    isRealTime: true
                };
            }
            
            async fetchYahooDirect(symbol) {
                const response = await this.fetchWithTimeout(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`, {
                    mode: 'cors',
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                    }
                }, 5000);
                
                if (!response.ok) {
                    throw new Error('Yahoo Finance directo bloqueado por CORS');
                }
                
                const data = await response.json();
                const result = data.chart.result[0];
                const meta = result.meta;
                
                return {
                    symbol: symbol,
                    name: meta.longName || symbol,
                    price: meta.regularMarketPrice,
                    change: meta.regularMarketPrice - meta.previousClose,
                    changePercent: ((meta.regularMarketPrice - meta.previousClose) / meta.previousClose) * 100,
                    volume: meta.regularMarketVolume,
                    currency: meta.currency || 'USD',
                    timestamp: Date.now(),
                    source: 'Yahoo Finance (Directo)',
                    isRealTime: true
                };
            }
            
            async getCompanyName(symbol) {
                const names = {
                    // === MEGA CAPS USA ===
                    'AAPL': 'Apple Inc.',
                    'GOOGL': 'Alphabet Inc.',
                    'MSFT': 'Microsoft Corporation',
                    'TSLA': 'Tesla, Inc.',
                    'AMZN': 'Amazon.com, Inc.',
                    'NVDA': 'NVIDIA Corporation',
                    'META': 'Meta Platforms, Inc.',
                    'NFLX': 'Netflix, Inc.',
                    'AMD': 'Advanced Micro Devices, Inc.',
                    
                    // === MERVAL ARGENTINA COMPLETO ===
                    'GGAL': 'Grupo Financiero Galicia S.A.',
                    'PAM': 'Pampa EnergÃ­a S.A.',
                    'BMA': 'Banco Macro S.A.',
                    'SUPV': 'Grupo Supervielle S.A.',
                    'CRESY': 'Cresud S.A.C.I.F. y A.',
                    'YPF': 'YPF Sociedad AnÃ³nima',
                    'TEO': 'Telecom Argentina S.A.',
                    'TX': 'Ternium S.A.',
                    'ARCO': 'Arcos Dorados Holdings Inc.',
                    'CEPU': 'Central Puerto S.A.',
                    'LOMA': 'Loma Negra CompaÃ±Ã­a Industrial Argentina Sociedad AnÃ³nima',
                    'IRSA': 'IRSA Inversiones y Representaciones Sociedad AnÃ³nima',
                    'MELI': 'MercadoLibre, Inc.',
                    'GLOB': 'Globant S.A.',
                    'DESP': 'Despegar.com, Corp.',
                    'EDN': 'Edenor S.A.',
                    'BBAR': 'Banco BBVA Argentina S.A.',
                    'COME': 'Banco de Comercio S.A.',
                    'MIRG': 'Mirae Asset Global Investments',
                    'TGSU2': 'Transportadora de Gas del Sur S.A.',
                    'TRAN': 'Transener S.A.',
                    'ALUA': 'Aluar Aluminio Argentino S.A.I.C.',
                    'TXAR': 'Ternium Argentina S.A.',
                    'VALO': 'Banco de Valores S.A.',
                    'CGPA2': 'CompaÃ±Ã­a General de Combustibles S.A.',
                    'TGNO4': 'Transportadora de Gas del Norte S.A.',
                    'PAMP': 'Pampa EnergÃ­a S.A.',
                    'RICH': 'Laboratorio Elea Phoenix S.A.',
                    'CRES': 'Cresud S.A.C.I.F. y A.',
                    'BHIP': 'Banco Hipotecario S.A.',
                    'BYMA': 'Bolsas y Mercados Argentinos S.A.',
                    'HAVA': 'Havanna Holding S.A.',
                    'INVJ': 'Inversora Juramento S.A.',
                    'LEDE': 'Ledesma S.A.A.I.',
                    'LONG': 'Longvie S.A.',
                    'METR': 'Metrogas S.A.',
                    'MOLA': 'Molinos Agro S.A.',
                    'MORI': 'Morixe Hermanos S.A.C.I.F.I.A.',
                    'OEST': 'Grupo Oesterheld S.A.',
                    'POLL': 'Pollo Vivo S.A.',
                    'RIGO': 'Rigolleau S.A.',
                    'ROSE': 'Rosario Puerto S.A.',
                    'SAMI': 'San Miguel A.G.I.C.I. y F.',
                    'SEMI': 'Molinos RÃ­o de la Plata S.A.',
                    'TECO2': 'Telecom Argentina S.A.',
                    'FERR': 'Ferrum S.A.I.C.',
                    'FIPL': 'Fiplasto S.A.',
                    'GARO': 'Garovaglio y ZorraquÃ­n S.A.',
                    'GCLA': 'Grupo ClarÃ­n S.A.',
                    'GRIM': 'Grimoldi S.A.',
                    'INTR': 'Intramed S.A.',
                    'CAPX': 'Capex S.A.',
                    'CARC': 'Carboclor S.A.',
                    'CTIO': 'Consultatio S.A.',
                    'DGCU2': 'Distribuidora de Gas Cuyana S.A.',
                    'DYCASA': 'Dycasa S.A.',
                    'ESME': 'Esmeralda Corp.',
                    'GBAN': 'Grupo Banco NaciÃ³n',
                    'HARG': 'Holcim Argentina S.A.',
                    
                    // === BYMA ARGENTINA EXTENDIDO ===
                    'AGPS': 'Agrometal S.A.',
                    'ALPA': 'Alpargatas S.A.',
                    'APBR': 'Petrobras Argentina S.A.',
                    'AUSO': 'Autopistas del Sol S.A.',
                    'BCBA': 'Bolsa de Comercio de Buenos Aires',
                    'BPAT': 'Banco Patagonia S.A.',
                    'CADO': 'Carlos Casado S.A.',
                    'CECO2': 'CompaÃ±Ã­a de Electricidad del Comahue S.A.',
                    'CELU': 'Celulosa Argentina S.A.',
                    'CVSA': 'CompaÃ±Ã­a de Valores Sudamericana S.A.',
                    'DOME': 'Domec S.A.',
                    'DYCA': 'Dycasa S.A.',
                    'EMDE': 'Empresa Mendocina de Electricidad S.A.',
                    'FAVI': 'FÃ¡brica Argentina de Vidrio Plano S.A.',
                    'GAMI': 'Gasnor S.A.',
                    'INAG': 'Industrias Alimenticias Argentinas S.A.',
                    'MERA': 'Mercado Argentino S.A.',
                    'MOLI': 'Molinos Juan Semino S.A.',
                    'MOVI': 'Movil Access S.A.',
                    'PATA': 'Patagonia Gold S.A.',
                    'PETR': 'Petrobras Argentina S.A.',
                    'RENO': 'Renova S.A.',
                    'TGLT': 'Tglt S.A.',
                    'WEED': 'Weed Inc.',
                    'YPFD': 'YPF Directo S.A.',
                    
                    // === BOVESPA BRASIL ===
                    'PETR4.SA': 'PetrÃ³leo Brasileiro S.A. - Petrobras',
                    'VALE3.SA': 'Vale S.A.',
                    'ITUB4.SA': 'ItaÃº Unibanco Holding S.A.',
                    'BBDC4.SA': 'Banco Bradesco S.A.',
                    'ABEV3.SA': 'Ambev S.A.',
                    
                    // === ADRs BRASILEÃ‘OS ===
                    'ITUB': 'ItaÃº Unibanco Holding S.A.',
                    'BBD': 'Banco Bradesco S.A.',
                    'PBR': 'PetrÃ³leo Brasileiro S.A. - Petrobras',
                    'VALE': 'Vale S.A.',
                    'ABEV': 'Ambev S.A.',
                    'NU': 'Nu Holdings Ltd.',
                    'PAGS': 'PagSeguro Digital Ltd.',
                    'STNE': 'StoneCo Ltd.'
                };
                
                return names[symbol] || `${symbol} Corporation`;
            }
            
            async generateFallbackData(symbol) {
                // IMPORTANTE: Este fallback solo se usa cuando TODAS las APIs fallan
                console.warn(`âš ï¸ FALLBACK: Generando datos simulados para ${symbol} - Las APIs reales no estÃ¡n disponibles`);
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Generar precio base dinÃ¡mico (no hardcodeado)
                const hash = this.hashString(symbol);
                const basePrice = 10 + (hash % 500); // Precio base entre $10 y $510
                const dayHash = this.hashString(symbol + new Date().toDateString());
                
                // Generar cambio realista basado en el dÃ­a
                const volatility = this.getVolatility(symbol);
                const changePercent = ((dayHash % 1000) / 1000 - 0.5) * volatility;
                const currentPrice = basePrice * (1 + changePercent / 100);
                const change = currentPrice - basePrice;
                
                const isArgentine = this.isArgentineStock(symbol);
                const sourceMessage = isArgentine 
                    ? 'âš ï¸ DATOS SIMULADOS - AcciÃ³n argentina sin API disponible'
                    : 'Datos Simulados (APIs no disponibles)';
                
                return {
                    symbol: symbol,
                    name: await this.getCompanyName(symbol),
                    price: currentPrice,
                    change: change,
                    changePercent: changePercent,
                    volume: this.getVolume(symbol, hash),
                    marketCap: this.getMarketCap(symbol, currentPrice),
                    currency: this.getCurrency(symbol),
                    timestamp: Date.now(),
                    source: sourceMessage,
                    isRealTime: false,
                    isSimulated: true,
                    method: 'Fallback Local'
                };
            }
            
            hashString(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }
            
            getVolatility(symbol) {
                const argentineStocks = ['GGAL', 'PAM', 'BMA', 'SUPV', 'YPF', 'TEO', 'TX', 'MELI', 'GLOB', 'ARCO', 'CEPU', 'LOMA', 'IRSA', 'DESP', 'EDN', 'BBAR', 'PAMP', 'ALUA', 'TRAN', 'TXAR', 'VALO', 'CGPA2', 'TGNO4', 'TGSU2', 'COME', 'MIRG', 'RICH', 'CRES', 'BHIP', 'BYMA', 'HAVA', 'INVJ', 'LEDE', 'LONG', 'METR', 'MOLA', 'MORI', 'OEST', 'POLL', 'RIGO', 'ROSE', 'SAMI', 'SEMI', 'TECO2', 'FERR', 'FIPL', 'GARO', 'GCLA', 'GRIM', 'INTR', 'CAPX', 'CARC', 'CTIO', 'DGCU2', 'DYCASA', 'ESME', 'GBAN', 'HARG', 'AGPS', 'ALPA', 'APBR', 'AUSO', 'BCBA', 'BPAT', 'CADO', 'CECO2', 'CELU', 'CVSA', 'DOME', 'DYCA', 'EMDE', 'FAVI', 'GAMI', 'INAG', 'MERA', 'MOLI', 'MOVI', 'PATA', 'PETR', 'RENO', 'TGLT', 'WEED', 'YPFD'];
                
                if (argentineStocks.includes(symbol)) return 7; // Argentina alta volatilidad
                if (['TSLA', 'NVDA', 'AMD'].includes(symbol)) return 6; // Tech volÃ¡til
                if (['AAPL', 'MSFT', 'GOOGL'].includes(symbol)) return 4; // Blue chips
                return 5; // Default
            }
            
            getVolume(symbol, hash) {
                const volumes = {
                    'GGAL': 5000000, 'PAM': 3000000, 'BMA': 2000000, 'MELI': 8000000,
                    'YPF': 4000000, 'LOMA': 1200000, 'BHIP': 1500000, 'PAMP': 2000000,
                    'AAPL': 50000000, 'TSLA': 80000000, 'NVDA': 45000000
                };
                
                const baseVolume = volumes[symbol] || 1000000;
                const variation = (hash % 50) / 100;
                return Math.floor(baseVolume * (0.5 + variation));
            }
            
            getMarketCap(symbol, price) {
                const shares = {
                    'GGAL': 380000000, 'PAM': 630000000, 'BMA': 540000000, 'LOMA': 350000000,
                    'BHIP': 1800000000, 'PAMP': 630000000, 'MELI': 50000000,
                    'AAPL': 15500000000, 'TSLA': 3200000000, 'NVDA': 2500000000
                };
                
                const shareCount = shares[symbol] || 500000000;
                return price * shareCount;
            }
            
            getCurrency(symbol) {
                const argentineStocks = ['GGAL', 'PAM', 'BMA', 'SUPV', 'YPF', 'TEO', 'TX', 'ARCO', 'CEPU', 'LOMA', 'IRSA', 'EDN', 'BBAR', 'PAMP', 'ALUA', 'TRAN', 'TXAR', 'VALO', 'CGPA2', 'TGNO4', 'TGSU2', 'COME', 'MIRG', 'RICH', 'CRES', 'BHIP', 'BYMA', 'HAVA', 'INVJ', 'LEDE', 'LONG', 'METR', 'MOLA', 'MORI', 'OEST', 'POLL', 'RIGO', 'ROSE', 'SAMI', 'SEMI', 'TECO2', 'FERR', 'FIPL', 'GARO', 'GCLA', 'GRIM', 'INTR', 'CAPX', 'CARC', 'CTIO', 'DGCU2', 'DYCASA', 'ESME', 'GBAN', 'HARG', 'AGPS', 'ALPA', 'APBR', 'AUSO', 'BCBA', 'BPAT', 'CADO', 'CECO2', 'CELU', 'CVSA', 'DOME', 'DYCA', 'EMDE', 'FAVI', 'GAMI', 'INAG', 'MERA', 'MOLI', 'MOVI', 'PATA', 'PETR', 'RENO', 'TGLT', 'WEED', 'YPFD'];
                
                if (argentineStocks.includes(symbol)) return 'ARS';
                if (symbol.endsWith('.SA')) return 'BRL';
                return 'USD';
            }
        }        

        class StockPredictor {
            constructor() {
                this.realTimeAPI = new RealTimeStockAPI();
                this.loadingSteps = [
                    'Obteniendo datos reales del mercado...',
                    'Verificando mÃºltiples fuentes de datos...',
                    'Analizando patrones tÃ©cnicos...',
                    'Evaluando fundamentos empresariales...',
                    'Procesando eventos y noticias...',
                    'Aplicando algoritmos de IA...',
                    'Calculando predicciÃ³n final...'
                ];
                
                // Inicializar autocompletado
                this.initializeAutocomplete();
                this.selectedIndex = -1;
            }
            
            initializeAutocomplete() {
                const input = document.getElementById('stockSymbol');
                const suggestions = document.getElementById('suggestions');
                
                // Base de datos de acciones para autocompletado
                this.stockDatabase = this.createStockDatabase();
                
                input.addEventListener('input', (e) => {
                    this.handleInput(e.target.value);
                });
                
                input.addEventListener('keydown', (e) => {
                    this.handleKeydown(e);
                });
                
                // Cerrar sugerencias al hacer clic fuera
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.autocomplete-container')) {
                        suggestions.classList.remove('show');
                    }
                });
            }
            
            createStockDatabase() {
                return [
                    // === USA MEGA CAPS ===
                    { symbol: 'AAPL', name: 'Apple Inc.', price: 175.50, market: 'USA', currency: 'USD' },
                    { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 132.80, market: 'USA', currency: 'USD' },
                    { symbol: 'MSFT', name: 'Microsoft Corporation', price: 378.25, market: 'USA', currency: 'USD' },
                    { symbol: 'TSLA', name: 'Tesla, Inc.', price: 248.75, market: 'USA', currency: 'USD' },
                    { symbol: 'AMZN', name: 'Amazon.com, Inc.', price: 145.60, market: 'USA', currency: 'USD' },
                    { symbol: 'NVDA', name: 'NVIDIA Corporation', price: 875.30, market: 'USA', currency: 'USD' },
                    { symbol: 'META', name: 'Meta Platforms, Inc.', price: 325.40, market: 'USA', currency: 'USD' },
                    { symbol: 'NFLX', name: 'Netflix, Inc.', price: 445.20, market: 'USA', currency: 'USD' },
                    { symbol: 'AMD', name: 'Advanced Micro Devices, Inc.', price: 142.90, market: 'USA', currency: 'USD' },
                    { symbol: 'JPM', name: 'JPMorgan Chase & Co.', price: 168.40, market: 'USA', currency: 'USD' },
                    { symbol: 'V', name: 'Visa Inc.', price: 245.80, market: 'USA', currency: 'USD' },
                    { symbol: 'JNJ', name: 'Johnson & Johnson', price: 158.90, market: 'USA', currency: 'USD' },
                    
                    // === ADRs ARGENTINOS EN NYSE (USD) ===
                    { symbol: 'GGAL', name: 'Grupo Financiero Galicia S.A. (ADR)', price: 42.50, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'BMA', name: 'Banco Macro S.A. (ADR)', price: 68.30, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'SUPV', name: 'Grupo Supervielle S.A. (ADR)', price: 4.85, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'YPF', name: 'YPF Sociedad AnÃ³nima (ADR)', price: 18.50, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'TEO', name: 'Telecom Argentina S.A. (ADR)', price: 8.90, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'TX', name: 'Ternium S.A. (ADR)', price: 48.50, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'PAM', name: 'Pampa EnergÃ­a S.A. (ADR)', price: 68.90, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'CEPU', name: 'Central Puerto S.A. (ADR)', price: 6.80, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'LOMA', name: 'Loma Negra (ADR)', price: 28.50, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'CRESY', name: 'Cresud S.A.C.I.F. y A. (ADR)', price: 12.80, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'EDN', name: 'Edenor S.A. (ADR)', price: 18.50, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'IRSA', name: 'IRSA Inversiones (ADR)', price: 4.25, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'MELI', name: 'MercadoLibre, Inc. (ADR)', price: 1285.60, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'GLOB', name: 'Globant S.A. (ADR)', price: 215.90, market: 'USA-ADR', currency: 'USD' },
                    { symbol: 'DESP', name: 'Despegar.com (ADR)', price: 12.50, market: 'USA-ADR', currency: 'USD' },
                    
                    // === ACCIONES LOCALES ARGENTINA (.BA) ===
                    { symbol: 'GGAL.BA', name: 'Grupo Financiero Galicia (Local)', price: 185.60, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BMA.BA', name: 'Banco Macro (Local)', price: 285.40, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'SUPV.BA', name: 'Grupo Supervielle (Local)', price: 4.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'PAMP.BA', name: 'Pampa EnergÃ­a (Local)', price: 68.90, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'YPFD.BA', name: 'YPF (Local)', price: 18.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'TECO2.BA', name: 'Telecom Argentina (Local)', price: 8.90, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'TXAR.BA', name: 'Ternium Argentina (Local)', price: 68.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'ALUA.BA', name: 'Aluar (Local)', price: 0.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'LOMA.BA', name: 'Loma Negra (Local)', price: 28.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CRES.BA', name: 'Cresud (Local)', price: 12.80, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CEPU.BA', name: 'Central Puerto (Local)', price: 6.80, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'EDN.BA', name: 'Edenor (Local)', price: 18.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'IRSA.BA', name: 'IRSA Inversiones (Local)', price: 4.25, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'COME.BA', name: 'Banco Comafi (Local)', price: 2.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BHIP.BA', name: 'Banco Hipotecario (Local)', price: 485.60, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BYMA.BA', name: 'Bolsas y Mercados Argentinos (Local)', price: 285.40, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'TRAN.BA', name: 'Transener (Local)', price: 1.25, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'TGSU2.BA', name: 'Transportadora Gas del Sur (Local)', price: 1.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'TGNO4.BA', name: 'Transportadora Gas del Norte (Local)', price: 18.50, market: 'Argentina', currency: 'ARS' },
                    
                    // === OTRAS ACCIONES ARGENTINA (sin ADR) ===
                    { symbol: 'ARCO', name: 'Arcos Dorados Holdings Inc.', price: 28.90, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BBAR', name: 'Banco BBVA Argentina S.A.', price: 6.80, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'MIRG', name: 'Mirae Asset Global Investments', price: 485.60, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'VALO', name: 'Banco de Valores S.A.', price: 2.45, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CGPA2', name: 'CompaÃ±Ã­a General de Combustibles S.A.', price: 3.85, market: 'Argentina', currency: 'ARS' },
                    
                    // === BYMA EXTENDIDO ===
                    { symbol: 'AGPS', name: 'Agrometal S.A.', price: 28.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'ALPA', name: 'Alpargatas S.A.', price: 68.90, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'APBR', name: 'Petrobras Argentina S.A.', price: 28.50, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BCBA', name: 'Bolsa de Comercio de Buenos Aires', price: 485.60, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'BPAT', name: 'Banco Patagonia S.A.', price: 2.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CADO', name: 'Carlos Casado S.A.', price: 4.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CECO2', name: 'CompaÃ±Ã­a de Electricidad del Comahue S.A.', price: 1.85, market: 'Argentina', currency: 'ARS' },
                    { symbol: 'CELU', name: 'Celulosa Argentina S.A.', price: 1.85, market: 'Argentina', currency: 'ARS' },
                    
                    // === BOVESPA BRASIL ===
                    { symbol: 'PETR4.SA', name: 'PetrÃ³leo Brasileiro S.A. - Petrobras', price: 28.50, market: 'Brasil', currency: 'BRL' },
                    { symbol: 'VALE3.SA', name: 'Vale S.A.', price: 68.90, market: 'Brasil', currency: 'BRL' },
                    { symbol: 'ITUB4.SA', name: 'ItaÃº Unibanco Holding S.A.', price: 32.50, market: 'Brasil', currency: 'BRL' },
                    { symbol: 'BBDC4.SA', name: 'Banco Bradesco S.A.', price: 18.50, market: 'Brasil', currency: 'BRL' },
                    { symbol: 'ABEV3.SA', name: 'Ambev S.A.', price: 12.80, market: 'Brasil', currency: 'BRL' },
                    
                    // === ADRs BRASILEÃ‘OS ===
                    { symbol: 'ITUB', name: 'ItaÃº Unibanco Holding S.A. (ADR)', price: 4.85, market: 'Brasil', currency: 'USD' },
                    { symbol: 'BBD', name: 'Banco Bradesco S.A. (ADR)', price: 2.85, market: 'Brasil', currency: 'USD' },
                    { symbol: 'PBR', name: 'PetrÃ³leo Brasileiro S.A. - Petrobras (ADR)', price: 12.80, market: 'Brasil', currency: 'USD' },
                    { symbol: 'VALE', name: 'Vale S.A. (ADR)', price: 12.50, market: 'Brasil', currency: 'USD' },
                    { symbol: 'NU', name: 'Nu Holdings Ltd.', price: 8.50, market: 'Brasil', currency: 'USD' },
                    { symbol: 'PAGS', name: 'PagSeguro Digital Ltd.', price: 8.90, market: 'Brasil', currency: 'USD' },
                    { symbol: 'STNE', name: 'StoneCo Ltd.', price: 12.80, market: 'Brasil', currency: 'USD' }
                ];
            }
            
            handleInput(value) {
                const suggestions = document.getElementById('suggestions');
                
                if (value.length < 1) {
                    suggestions.classList.remove('show');
                    return;
                }
                
                const filtered = this.stockDatabase.filter(stock => 
                    stock.symbol.toLowerCase().includes(value.toLowerCase()) ||
                    stock.name.toLowerCase().includes(value.toLowerCase())
                ).slice(0, 8); // Mostrar mÃ¡ximo 8 sugerencias
                
                if (filtered.length === 0) {
                    suggestions.innerHTML = '<div class="no-suggestions">No se encontraron sÃ­mbolos</div>';
                    suggestions.classList.add('show');
                    return;
                }
                
                suggestions.innerHTML = filtered.map((stock, index) => {
                    // Ocultar .BA del sÃ­mbolo en la visualizaciÃ³n
                    const displaySymbol = stock.symbol.replace('.BA', '');
                    
                    // Determinar etiqueta de mercado
                    let marketLabel = stock.market;
                    if (stock.symbol.includes('.BA')) {
                        marketLabel = 'BYMA'; // Bolsas y Mercados Argentinos
                    } else if (stock.market === 'USA-ADR') {
                        marketLabel = 'NYSE-ADR';
                    }
                    
                    return `
                        <div class="suggestion-item" data-symbol="${stock.symbol}" data-index="${index}">
                            <div class="suggestion-symbol">${displaySymbol}</div>
                            <div class="suggestion-name">${stock.name}</div>
                            <div class="suggestion-info">
                                <span class="suggestion-market ${stock.market.toLowerCase()}">${marketLabel}</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                suggestions.classList.add('show');
                this.selectedIndex = -1;
                
                // Agregar event listeners a las sugerencias
                suggestions.querySelectorAll('.suggestion-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.selectSuggestion(item.dataset.symbol);
                    });
                });
            }
            
            handleKeydown(e) {
                const suggestions = document.getElementById('suggestions');
                const items = suggestions.querySelectorAll('.suggestion-item');
                
                if (!suggestions.classList.contains('show')) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        this.selectedIndex = Math.min(this.selectedIndex + 1, items.length - 1);
                        this.updateSelection(items);
                        break;
                        
                    case 'ArrowUp':
                        e.preventDefault();
                        this.selectedIndex = Math.max(this.selectedIndex - 1, -1);
                        this.updateSelection(items);
                        break;
                        
                    case 'Enter':
                        e.preventDefault();
                        if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
                            this.selectSuggestion(items[this.selectedIndex].dataset.symbol);
                        }
                        break;
                        
                    case 'Escape':
                        suggestions.classList.remove('show');
                        this.selectedIndex = -1;
                        break;
                }
            }
            
            updateSelection(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('selected', index === this.selectedIndex);
                });
            }
            
            selectSuggestion(symbol) {
                const input = document.getElementById('stockSymbol');
                const suggestions = document.getElementById('suggestions');
                
                input.value = symbol;
                suggestions.classList.remove('show');
                this.selectedIndex = -1;
                
                // Opcional: trigger automÃ¡tico de predicciÃ³n
                // this.triggerPrediction();
            }
            
            formatPrice(price, currency) {
                const currencySymbols = {
                    'USD': '$',
                    'ARS': '$',
                    'BRL': 'R$'
                };
                
                const symbol = currencySymbols[currency] || '$';
                
                if (price >= 1000) {
                    return `${symbol}${(price / 1000).toFixed(1)}K`;
                } else if (price >= 100) {
                    return `${symbol}${price.toFixed(0)}`;
                } else if (price >= 10) {
                    return `${symbol}${price.toFixed(1)}`;
                } else {
                    return `${symbol}${price.toFixed(2)}`;
                }
            }
            
            async predictStock(symbol, timeframe, event) {
                // Mostrar pasos de carga
                for (let i = 0; i < this.loadingSteps.length; i++) {
                    document.getElementById('loadingStep').textContent = this.loadingSteps[i];
                    await this.delay(800);
                }
                
                // Obtener datos reales
                const realData = await this.realTimeAPI.getRealPrice(symbol);
                
                // ðŸ¤– NUEVO: AnÃ¡lisis con IA Gemini (real o simulado)
                let aiAnalysis = null;
                if (this.hasGeminiAPI()) {
                    document.getElementById('loadingStep').textContent = 'ðŸ¤– Analizando con IA Gemini...';
                    aiAnalysis = await this.analyzeWithGemini(realData, timeframe, event);
                }
                
                // Si no hay IA real, generar anÃ¡lisis simulado
                if (!aiAnalysis) {
                    document.getElementById('loadingStep').textContent = 'ðŸ¤– Generando anÃ¡lisis IA simulado...';
                    aiAnalysis = this.generateSimulatedAIAnalysis(realData, timeframe, event);
                }
                
                // Generar predicciÃ³n mejorada con IA
                const prediction = this.generateEnhancedPrediction(realData, timeframe, event, aiAnalysis);
                
                return prediction;
            }
            
            // ðŸ¤– Verificar si Gemini API estÃ¡ configurada
            hasGeminiAPI() {
                return window.GEMINI_API_KEY && window.GEMINI_API_KEY !== 'TU_GEMINI_API_KEY_AQUI';
            }
            
            // ðŸ¤– Generar anÃ¡lisis IA simulado cuando no hay API key
            generateSimulatedAIAnalysis(realData, timeframe, event) {
                // AnÃ¡lisis simulado basado en datos tÃ©cnicos
                const changePercent = realData.changePercent || 0;
                const volume = realData.volume || 1000000;
                
                // Simular sentimiento basado en cambio de precio
                let sentiment = 5;
                if (changePercent > 2) sentiment = 8;
                else if (changePercent > 0.5) sentiment = 7;
                else if (changePercent < -2) sentiment = 2;
                else if (changePercent < -0.5) sentiment = 3;
                
                // Simular anÃ¡lisis tÃ©cnico
                let technicalScore = 5;
                if (Math.abs(changePercent) > 1) technicalScore = changePercent > 0 ? 7 : 3;
                else technicalScore = 5 + (changePercent * 2);
                
                // Simular impacto de eventos
                let eventImpact = 5;
                if (event && event.trim()) {
                    eventImpact = Math.random() > 0.5 ? 7 : 3;
                }
                
                // Simular nivel de riesgo
                const riskLevel = Math.max(1, Math.min(10, 5 + Math.abs(changePercent)));
                
                // Determinar direcciÃ³n
                let direction = 'NEUTRAL';
                const avgScore = (sentiment + technicalScore + eventImpact) / 3;
                if (avgScore > 6) direction = 'ALCISTA';
                else if (avgScore < 4) direction = 'BAJISTA';
                
                // Generar razonamiento
                const reasonings = [
                    `AnÃ¡lisis tÃ©cnico indica tendencia ${direction.toLowerCase()} basada en movimiento de precio del ${changePercent.toFixed(2)}%`,
                    `Indicadores de momentum sugieren ${direction === 'ALCISTA' ? 'fortaleza' : direction === 'BAJISTA' ? 'debilidad' : 'consolidaciÃ³n'} en el corto plazo`,
                    `Volumen de trading ${volume > 2000000 ? 'elevado' : 'moderado'} confirma la direcciÃ³n del movimiento`,
                    event ? `Evento mencionado podrÃ­a tener impacto ${eventImpact > 5 ? 'positivo' : 'negativo'} en el precio` : 'Sin eventos significativos identificados'
                ];
                
                return {
                    sentiment: Math.round(sentiment),
                    technicalScore: Math.round(technicalScore),
                    eventImpact: Math.round(eventImpact),
                    riskLevel: Math.round(riskLevel),
                    direction: direction,
                    confidence: Math.round(5 + Math.random() * 3), // 5-8 para simulado
                    reasoning: reasonings[Math.floor(Math.random() * reasonings.length)]
                };
            }

            // ðŸ¤– AnÃ¡lisis avanzado con Gemini AI
            async analyzeWithGemini(realData, timeframe, event) {
                if (!this.hasGeminiAPI()) return null;
                
                try {
                    const prompt = this.buildGeminiPrompt(realData, timeframe, event);
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${window.GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        console.warn('Gemini API error:', response.status);
                        return null;
                    }
                    
                    const data = await response.json();
                    const aiText = data.candidates[0]?.content?.parts[0]?.text;
                    
                    if (aiText) {
                        return this.parseGeminiResponse(aiText);
                    }
                    
                } catch (error) {
                    console.warn('Error con Gemini AI:', error);
                }
                
                return null;
            }
            
            // ðŸ¤– Construir prompt inteligente para Gemini
            buildGeminiPrompt(realData, timeframe, event) {
                const company = realData.name || realData.symbol;
                const price = realData.price;
                const change = realData.changePercent || 0;
                const currency = realData.currency || 'USD';
                
                return `ActÃºa como un analista financiero experto. Analiza la siguiente informaciÃ³n de ${company} (${realData.symbol}):

DATOS ACTUALES:
- Precio: ${price} ${currency}
- Cambio: ${change.toFixed(2)}%
- Marco temporal: ${timeframe}
- Evento: ${event || 'Ninguno'}

ANÃLISIS REQUERIDO:
1. Sentimiento del mercado (1-10)
2. Factores tÃ©cnicos clave
3. Impacto de eventos recientes
4. Riesgo/oportunidad (1-10)
5. PredicciÃ³n direccional (ALCISTA/BAJISTA/NEUTRAL)
6. Confianza del anÃ¡lisis (1-10)

FORMATO DE RESPUESTA (JSON):
{
  "sentiment": 7,
  "technical_score": 6,
  "event_impact": 5,
  "risk_level": 4,
  "direction": "ALCISTA",
  "confidence": 8,
  "reasoning": "Breve explicaciÃ³n del anÃ¡lisis"
}

Responde SOLO con el JSON, sin texto adicional.`;
            }
            
            // ðŸ¤– Parsear respuesta de Gemini
            parseGeminiResponse(aiText) {
                try {
                    // Extraer JSON de la respuesta
                    const jsonMatch = aiText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        return {
                            sentiment: parsed.sentiment || 5,
                            technicalScore: parsed.technical_score || 5,
                            eventImpact: parsed.event_impact || 5,
                            riskLevel: parsed.risk_level || 5,
                            direction: parsed.direction || 'NEUTRAL',
                            confidence: parsed.confidence || 5,
                            reasoning: parsed.reasoning || 'AnÃ¡lisis IA completado'
                        };
                    }
                } catch (error) {
                    console.warn('Error parseando respuesta Gemini:', error);
                }
                
                // Fallback si no se puede parsear
                return {
                    sentiment: 5,
                    technicalScore: 5,
                    eventImpact: 5,
                    riskLevel: 5,
                    direction: 'NEUTRAL',
                    confidence: 5,
                    reasoning: 'AnÃ¡lisis IA no disponible'
                };
            }
            
            // ðŸ¤– PredicciÃ³n mejorada con IA
            generateEnhancedPrediction(realData, timeframe, event, aiAnalysis) {
                // AnÃ¡lisis base (mÃ©todo original)
                const basePrediction = this.generatePrediction(realData, timeframe, event);
                
                // Siempre usar IA (real o simulada)
                if (!aiAnalysis) {
                    // Esto no deberÃ­a pasar, pero por seguridad
                    aiAnalysis = this.generateSimulatedAIAnalysis(realData, timeframe, event);
                }
                
                // ðŸš€ MEJORAR con IA Gemini
                const aiWeight = 0.4; // 40% peso de IA, 60% anÃ¡lisis tÃ©cnico
                const baseWeight = 0.6;
                
                // Combinar factores
                const enhancedTechnical = (basePrediction.factors.technical * baseWeight) + 
                                        ((aiAnalysis.technicalScore - 5) / 5 * aiWeight);
                
                const enhancedFundamental = (basePrediction.factors.fundamental * baseWeight) + 
                                          ((aiAnalysis.sentiment - 5) / 5 * aiWeight);
                
                const enhancedEvent = (basePrediction.factors.event * baseWeight) + 
                                    ((aiAnalysis.eventImpact - 5) / 5 * aiWeight);
                
                // Calcular nueva predicciÃ³n
                const totalFactor = (enhancedTechnical + enhancedFundamental + enhancedEvent) / 3;
                const timeMultipliers = {
                    '5m': 0.003, '10m': 0.005, '15m': 0.008, '30m': 0.012, '1h': 0.018,
                    '1d': 0.025, '1w': 0.055, '1m': 0.120,
                    '3m': 0.250, '6m': 0.350, '1y': 0.500
                };
                
                const multiplier = timeMultipliers[timeframe] || 0.025;
                const enhancedChangePercent = totalFactor * multiplier * 100;
                const enhancedPredictedPrice = realData.price * (1 + enhancedChangePercent / 100);
                
                // Confianza mejorada con IA
                const enhancedConfidence = Math.min(95, basePrediction.confidence + (aiAnalysis.confidence * 2));
                
                return {
                    ...basePrediction,
                    predictedPrice: enhancedPredictedPrice,
                    changePercent: enhancedChangePercent,
                    confidence: enhancedConfidence,
                    recommendation: this.getEnhancedRecommendation(enhancedChangePercent, enhancedConfidence, aiAnalysis.direction),
                    aiAnalysis: aiAnalysis,
                    isAIEnhanced: this.hasGeminiAPI(), // true solo si hay API key real
                    factors: {
                        technical: enhancedTechnical,
                        fundamental: enhancedFundamental,
                        event: enhancedEvent,
                        market: basePrediction.factors.market
                    }
                };
            }
            
            // ðŸ¤– RecomendaciÃ³n mejorada con IA
            getEnhancedRecommendation(changePercent, confidence, aiDirection) {
                // Combinar anÃ¡lisis tÃ©cnico + IA para recomendaciÃ³n mÃ¡s precisa
                let action = 'MANTENER';
                let cssClass = 'rec-hold';
                
                // Recomendaciones con alta confianza (IA + TÃ©cnico)
                if (confidence > 80) {
                    if (changePercent > 3 && aiDirection === 'ALCISTA') {
                        action = 'ðŸš€ COMPRAR FUERTE';
                        cssClass = 'rec-buy';
                    } else if (changePercent > 1.5 && aiDirection === 'ALCISTA') {
                        action = 'ðŸ“ˆ COMPRAR';
                        cssClass = 'rec-buy';
                    } else if (changePercent < -3 && aiDirection === 'BAJISTA') {
                        action = 'ðŸ“‰ VENDER FUERTE';
                        cssClass = 'rec-sell';
                    } else if (changePercent < -1.5 && aiDirection === 'BAJISTA') {
                        action = 'â¬‡ï¸ VENDER';
                        cssClass = 'rec-sell';
                    } else {
                        action = 'â¸ï¸ MANTENER';
                        cssClass = 'rec-hold';
                    }
                } else if (confidence > 70) {
                    if (changePercent > 2 && aiDirection === 'ALCISTA') {
                        action = 'ðŸ“ˆ COMPRAR';
                        cssClass = 'rec-buy';
                    } else if (changePercent < -2 && aiDirection === 'BAJISTA') {
                        action = 'â¬‡ï¸ VENDER';
                        cssClass = 'rec-sell';
                    } else {
                        action = 'â¸ï¸ MANTENER';
                        cssClass = 'rec-hold';
                    }
                } else if (confidence > 60) {
                    if (changePercent > 1.5) {
                        action = 'ðŸ“Š COMPRAR (Cauteloso)';
                        cssClass = 'rec-buy';
                    } else if (changePercent < -1.5) {
                        action = 'ðŸ“Š VENDER (Cauteloso)';
                        cssClass = 'rec-sell';
                    } else {
                        action = 'â¸ï¸ MANTENER';
                        cssClass = 'rec-hold';
                    }
                } else {
                    action = 'âš ï¸ MANTENER (Baja Confianza)';
                    cssClass = 'rec-hold';
                }
                
                return { action: action, class: cssClass };
            }
            
            generatePrediction(realData, timeframe, event) {
                // Usar precio real como base
                const currentPrice = realData.price;
                
                // Factores de anÃ¡lisis mejorados con datos reales
                const technicalFactor = this.analyzeTechnicalWithRealData(realData);
                const fundamentalFactor = this.analyzeFundamental(realData.symbol);
                const eventFactor = this.analyzeEvent(event);
                const marketFactor = this.analyzeMarketWithRealData(realData);
                
                // Multiplicadores por timeframe
                const timeMultipliers = {
                    '5m': 0.003, '10m': 0.005, '15m': 0.008, '30m': 0.012, '1h': 0.018,
                    '1d': 0.025, '1w': 0.055, '1m': 0.120,
                    '3m': 0.250, '6m': 0.350, '1y': 0.500
                };
                
                const multiplier = timeMultipliers[timeframe] || 0.025;
                
                // Calcular cambio predicho
                const totalFactor = (technicalFactor + fundamentalFactor + eventFactor + marketFactor) / 4;
                const changePercent = totalFactor * multiplier * 100;
                const predictedPrice = currentPrice * (1 + changePercent / 100);
                
                // Calcular confianza mejorada con datos reales
                const confidence = this.calculateConfidenceWithRealData(realData, technicalFactor, fundamentalFactor, eventFactor);
                
                return {
                    symbol: realData.symbol,
                    name: realData.name,
                    currentPrice,
                    predictedPrice,
                    changePercent,
                    timeframe,
                    confidence,
                    recommendation: this.getRecommendation(changePercent, confidence, timeframe),
                    realData: realData,
                    factors: {
                        technical: technicalFactor,
                        fundamental: fundamentalFactor,
                        event: eventFactor,
                        market: marketFactor
                    },
                    analysis: this.generateAnalysis(realData.symbol, changePercent, timeframe, event)
                };
            }
            
            analyzeTechnicalWithRealData(realData) {
                let score = 0;
                const indicators = {};
                
                // RSI simulado basado en cambio del dÃ­a
                const dayChange = realData.changePercent || 0;
                indicators.rsi = Math.max(10, Math.min(90, 50 + (dayChange * 2)));
                
                if (indicators.rsi < 30) {
                    score += 0.3;
                    indicators.rsiSignal = 'BUY';
                } else if (indicators.rsi > 70) {
                    score -= 0.3;
                    indicators.rsiSignal = 'SELL';
                } else {
                    indicators.rsiSignal = 'NEUTRAL';
                }
                
                // MACD simulado
                const hash = this.hashString(realData.symbol);
                indicators.macd = ((hash % 200) / 100 - 1) * 0.5;
                indicators.macdSignal = ((hash % 180) / 100 - 0.9) * 0.5;
                indicators.macdHistogram = indicators.macd - indicators.macdSignal;
                
                if (indicators.macdHistogram > 0) {
                    score += 0.2;
                    indicators.macdSignalType = 'BUY';
                } else {
                    score -= 0.2;
                    indicators.macdSignalType = 'SELL';
                }
                
                // Medias mÃ³viles simuladas
                const currentPrice = realData.price;
                indicators.sma20 = currentPrice * (0.98 + (hash % 40) / 1000);
                indicators.sma50 = currentPrice * (0.96 + (hash % 60) / 1000);
                
                if (currentPrice > indicators.sma20 && indicators.sma20 > indicators.sma50) {
                    score += 0.25;
                    indicators.maSignal = 'BUY';
                } else if (currentPrice < indicators.sma20 && indicators.sma20 < indicators.sma50) {
                    score -= 0.25;
                    indicators.maSignal = 'SELL';
                } else {
                    indicators.maSignal = 'NEUTRAL';
                }
                
                // AnÃ¡lisis de volumen
                if (realData.volume && typeof realData.volume === 'number') {
                    const avgVolume = realData.volume * 0.8;
                    indicators.volumeRatio = realData.volume / avgVolume;
                    
                    if (realData.volume > avgVolume * 1.5) {
                        score += 0.2;
                        indicators.volumeSignal = 'HIGH';
                    } else if (realData.volume < avgVolume * 0.5) {
                        score -= 0.1;
                        indicators.volumeSignal = 'LOW';
                    } else {
                        indicators.volumeSignal = 'NORMAL';
                    }
                } else {
                    indicators.volumeRatio = 1;
                    indicators.volumeSignal = 'N/A';
                }
                
                // Bandas de Bollinger simuladas
                indicators.bbUpper = currentPrice * 1.02;
                indicators.bbLower = currentPrice * 0.98;
                indicators.bbMiddle = currentPrice;
                
                if (currentPrice < indicators.bbLower) {
                    score += 0.15;
                    indicators.bbSignal = 'BUY';
                } else if (currentPrice > indicators.bbUpper) {
                    score -= 0.15;
                    indicators.bbSignal = 'SELL';
                } else {
                    indicators.bbSignal = 'NEUTRAL';
                }
                
                // Guardar indicadores para mostrar en la UI
                this.lastTechnicalIndicators = indicators;
                
                return Math.max(-1, Math.min(1, score));
            }
            
            analyzeMarketWithRealData(realData) {
                let score = 0;
                
                // Usar el cambio real como indicador del mercado
                const marketSentiment = realData.changePercent || 0;
                score += marketSentiment * 0.05; // Factor de mercado basado en cambio real
                
                // Factor de hora del mercado
                const hour = new Date().getHours();
                if (hour >= 9 && hour <= 16) score += 0.1; // Horario de mercado
                
                return Math.max(-0.5, Math.min(0.5, score));
            }
            
            calculateConfidenceWithRealData(realData, technical, fundamental, event) {
                let baseConfidence = 70; // Mayor confianza base por usar datos reales
                
                // Bonus por tener datos reales
                if (realData.isRealTime) baseConfidence += 10;
                if (realData.volume && typeof realData.volume === 'number') baseConfidence += 5;
                if (realData.marketCap) baseConfidence += 5;
                
                // Consistencia de factores
                const factors = [technical, fundamental, event].filter(f => f !== 0);
                if (factors.length > 0) {
                    const avg = factors.reduce((a, b) => a + b, 0) / factors.length;
                    const consistency = 1 - Math.abs(Math.max(...factors) - Math.min(...factors));
                    baseConfidence += consistency * 10;
                }
                
                return Math.max(60, Math.min(95, baseConfidence));
            }          
  
            analyzeFundamental(symbol) {
                const hash = this.hashString(symbol + 'fund');
                const pe = 15 + (hash % 30);
                const growth = (hash % 30) - 10;
                
                let score = 0;
                if (pe < 20) score += 0.2;
                else if (pe > 35) score -= 0.2;
                
                score += (growth / 100) * 2;
                return Math.max(-1, Math.min(1, score));
            }
            
            analyzeEvent(event) {
                if (!event || event.trim() === '') {
                    this.lastEventAnalysis = null;
                    return 0;
                }
                
                const text = event.toLowerCase();
                let score = 0;
                let reasoning = [];
                
                // Palabras clave positivas
                const positiveWords = {
                    'ganancias': 0.3, 'beneficios': 0.3, 'crecimiento': 0.25, 'expansiÃ³n': 0.2,
                    'innovaciÃ³n': 0.2, 'Ã©xito': 0.2, 'rÃ©cord': 0.25, 'alza': 0.2,
                    'subida': 0.2, 'mejora': 0.15, 'aumento': 0.15, 'positivo': 0.1
                };
                
                // Palabras clave negativas
                const negativeWords = {
                    'pÃ©rdidas': -0.3, 'crisis': -0.3, 'caÃ­da': -0.25, 'problemas': -0.2,
                    'reducciÃ³n': -0.2, 'despidos': -0.25, 'baja': -0.2, 'declive': -0.2,
                    'recesiÃ³n': -0.3, 'quiebra': -0.4, 'negativo': -0.1, 'riesgo': -0.15
                };
                
                // Eventos especÃ­ficos conocidos
                const knownEvents = {
                    'resultados trimestrales': { impact: 0.2, reason: 'Los resultados trimestrales suelen generar volatilidad significativa' },
                    'dividendos': { impact: 0.15, reason: 'El anuncio de dividendos generalmente es positivo para el precio' },
                    'split': { impact: 0.1, reason: 'Los splits de acciones suelen indicar confianza de la empresa' },
                    'fusiÃ³n': { impact: 0.25, reason: 'Las fusiones pueden crear valor para los accionistas' },
                    'adquisiciÃ³n': { impact: 0.2, reason: 'Las adquisiciones pueden impulsar el crecimiento' },
                    'fed': { impact: -0.1, reason: 'Las decisiones de la Fed afectan todo el mercado' },
                    'inflaciÃ³n': { impact: -0.15, reason: 'La inflaciÃ³n alta presiona los mercados' },
                    'guerra': { impact: -0.3, reason: 'Los conflictos geopolÃ­ticos aumentan la incertidumbre' }
                };
                
                // Analizar palabras positivas
                Object.entries(positiveWords).forEach(([word, impact]) => {
                    if (text.includes(word)) {
                        score += impact;
                        reasoning.push(`Detectado "${word}": impacto positivo (+${(impact*100).toFixed(0)}%)`);
                    }
                });
                
                // Analizar palabras negativas
                Object.entries(negativeWords).forEach(([word, impact]) => {
                    if (text.includes(word)) {
                        score += impact;
                        reasoning.push(`Detectado "${word}": impacto negativo (${(impact*100).toFixed(0)}%)`);
                    }
                });
                
                // Analizar eventos conocidos
                Object.entries(knownEvents).forEach(([eventKey, eventData]) => {
                    if (text.includes(eventKey)) {
                        score += eventData.impact;
                        reasoning.push(`Evento identificado: ${eventData.reason}`);
                    }
                });
                
                // AnÃ¡lisis de contexto adicional
                if (text.includes('banco central') || text.includes('tipos de interÃ©s')) {
                    score -= 0.1;
                    reasoning.push('Eventos de polÃ­tica monetaria tienden a crear volatilidad');
                }
                
                if (text.includes('earnings') || text.includes('resultados')) {
                    score += 0.1;
                    reasoning.push('Los resultados empresariales son catalizadores importantes');
                }
                
                this.lastEventAnalysis = {
                    score: score,
                    reasoning: reasoning,
                    impact: score > 0.1 ? 'POSITIVO' : score < -0.1 ? 'NEGATIVO' : 'NEUTRAL'
                };
                
                return Math.max(-1, Math.min(1, score));
            }
            
            getRecommendation(changePercent, confidence, timeframe) {
                if (confidence < 65) return { action: 'âš ï¸ MANTENER (Baja Confianza)', class: 'rec-hold' };
                
                let buyStrong, buyWeak, sellStrong, sellWeak;
                
                if (['5m', '10m', '15m', '30m', '1h'].includes(timeframe)) {
                    buyStrong = 0.8; buyWeak = 0.3; sellStrong = -0.8; sellWeak = -0.3;
                } else if (['1d', '1w'].includes(timeframe)) {
                    buyStrong = 3; buyWeak = 1; sellStrong = -3; sellWeak = -1;
                } else {
                    buyStrong = 15; buyWeak = 5; sellStrong = -15; sellWeak = -5;
                }
                
                if (changePercent > buyStrong) return { action: 'ðŸš€ COMPRAR FUERTE', class: 'rec-buy' };
                else if (changePercent > buyWeak) return { action: 'ðŸ“ˆ COMPRAR', class: 'rec-buy' };
                else if (changePercent < sellStrong) return { action: 'ðŸ“‰ VENDER FUERTE', class: 'rec-sell' };
                else if (changePercent < sellWeak) return { action: 'â¬‡ï¸ VENDER', class: 'rec-sell' };
                else return { action: 'â¸ï¸ MANTENER', class: 'rec-hold' };
            }
            
            generateAnalysis(symbol, changePercent, timeframe, event) {
                const direction = changePercent > 0 ? 'alcista' : 'bajista';
                let strength;
                
                if (['5m', '10m', '15m', '30m', '1h'].includes(timeframe)) {
                    strength = Math.abs(changePercent) > 0.5 ? 'fuerte' : 'moderado';
                } else if (['1d', '1w'].includes(timeframe)) {
                    strength = Math.abs(changePercent) > 2 ? 'fuerte' : 'moderado';
                } else {
                    strength = Math.abs(changePercent) > 10 ? 'fuerte' : 'moderado';
                }
                
                const analysis = [
                    `Tendencia ${direction} ${strength} proyectada para ${symbol}`,
                    `Marco temporal: ${this.getTimeframeName(timeframe)}`,
                    `Cambio esperado: ${changePercent > 0 ? '+' : ''}${changePercent.toFixed(3)}%`,
                    `âœ… Basado en datos reales del mercado financiero`
                ];
                
                if (['5m', '10m', '15m', '30m', '1h'].includes(timeframe)) {
                    analysis.push('âš¡ AnÃ¡lisis de scalping/day trading - Alta frecuencia');
                } else if (['1d', '1w', '1m'].includes(timeframe)) {
                    analysis.push('ðŸ“Š AnÃ¡lisis de swing trading - Mediano plazo');
                } else {
                    analysis.push('ðŸ“ˆ AnÃ¡lisis de inversiÃ³n - Largo plazo');
                }
                
                if (event && event.trim() !== '') {
                    analysis.push(`Evento considerado: ${event.substring(0, 50)}...`);
                }
                
                return analysis;
            }
            
            getTimeframeName(timeframe) {
                const names = {
                    '5m': '5 minutos', '10m': '10 minutos', '15m': '15 minutos', '30m': '30 minutos', '1h': '1 hora',
                    '1d': '1 dÃ­a', '1w': '1 semana', '1m': '1 mes',
                    '3m': '3 meses', '6m': '6 meses', '1y': '1 aÃ±o'
                };
                return names[timeframe] || timeframe;
            }
            
            hashString(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        } 
       
        const predictor = new StockPredictor();
        
        // Variables globales del slider
        let currentNewsSlide = 0;
        let newsSlides = [];
        window.newsSlides = newsSlides;
        
        // Cargar noticias financieras con slider
        async function loadFinancialNews() {
            const sliderWrapper = document.getElementById('newsSliderWrapper');
            
            try {
                // Pool amplio de noticias variadas
                const allNews = [
                    {
                        title: 'Mercados globales en alza tras datos econÃ³micos positivos',
                        description: 'Los principales Ã­ndices bursÃ¡tiles registran ganancias significativas despuÃ©s de la publicaciÃ³n de datos econÃ³micos que superaron las expectativas. El S&P 500 y el NASDAQ lideran las subas.',
                        source: 'Yahoo Finance',
                        time: 'Hace 2 horas',
                        link: 'https://finance.yahoo.com',
                        image: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=800&h=400&fit=crop'
                    },
                    {
                        title: 'Fed mantiene tasas de interÃ©s estables en Ãºltima reuniÃ³n',
                        description: 'La Reserva Federal decidiÃ³ mantener las tasas de interÃ©s sin cambios, seÃ±alando un enfoque cauteloso ante la evoluciÃ³n de la inflaciÃ³n y el mercado laboral.',
                        source: 'MarketWatch', 
                        time: 'Hace 4 horas',
                        link: 'https://www.marketwatch.com',
                        image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=800&h=400&fit=crop'
                    },
                    {
                        title: 'Acciones tecnolÃ³gicas lideran ganancias en Wall Street',
                        description: 'Las grandes tecnolÃ³gicas impulsan el rally del mercado. Apple, Microsoft y Google registran mÃ¡ximos histÃ³ricos impulsados por resultados trimestrales excepcionales.',
                        source: 'Bloomberg',
                        time: 'Hace 6 horas',
                        link: 'https://www.bloomberg.com',
                        image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop'
                    },
                    {
                        title: 'Mercado argentino: MERVAL cierra con tendencia mixta',
                        description: 'El Ã­ndice MERVAL mostrÃ³ un comportamiento dispar con bancos en alza y energÃ©ticas en baja. Los inversores evalÃºan las Ãºltimas medidas econÃ³micas del gobierno.',
                        source: 'Ãmbito Financiero',
                        time: 'Hace 8 horas',
                        link: 'https://www.ambito.com',
                        image: 'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=800&h=400&fit=crop'
                    },
                    {
                        title: 'DÃ³lar blue y oficial: cotizaciones del dÃ­a',
                        description: 'El dÃ³lar blue opera con leve suba mientras el oficial se mantiene estable. La brecha cambiaria se ubica en niveles histÃ³ricos bajos segÃºn operadores del mercado.',
                        source: 'Ãmbito Financiero',
                        time: 'Hace 10 horas',
                        link: 'https://www.ambito.com',
                        image: 'https://images.unsplash.com/photo-1580519542036-c47de6196ba5?w=800&h=400&fit=crop'
                    },
                    {
                        title: 'AnÃ¡lisis: Perspectivas del mercado para el prÃ³ximo trimestre',
                        description: 'Expertos analizan las tendencias que marcarÃ¡n los prÃ³ximos meses. Factores como la polÃ­tica monetaria, geopolÃ­tica y resultados corporativos serÃ¡n clave.',
                        source: 'Reuters',
                        time: 'Hace 12 horas',
                        link: 'https://www.reuters.com',
                        image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop'
                    }
                ];
                
                // Mezclar aleatoriamente y seleccionar 5 noticias
                const shuffled = allNews.sort(() => Math.random() - 0.5);
                newsSlides = shuffled.slice(0, 5);
                
                // Crear slides HTML
                const slidesHTML = newsSlides.map((news, index) => `
                    <div class="news-slide">
                        <img src="${news.image}" alt="${news.title}" class="news-slide-image" 
                             onerror="this.src='https://via.placeholder.com/800x400/34495e/ecf0f1?text=Financial+News'">
                        <div class="news-slide-content">
                            <h3 class="news-slide-title">${news.title}</h3>
                            <p class="news-slide-description">${news.description}</p>
                            <div class="news-slide-meta">
                                <span class="news-slide-source">${news.source}</span>
                                <span class="news-slide-time">${news.time}</span>
                            </div>
                            <a href="${news.link}" target="_blank" class="news-slide-link">
                                Leer mÃ¡s â†’
                            </a>
                        </div>
                    </div>
                `).join('');
                
                sliderWrapper.innerHTML = slidesHTML;
                
                // Crear indicadores
                createNewsSliderDots();
                
                // Auto-play cada 5 segundos
                setInterval(() => {
                    changeNewsSlide(1);
                }, 5000);
                
            } catch (error) {
                console.error('Error cargando noticias:', error);
                sliderWrapper.innerHTML = `
                    <div class="news-slide">
                        <div class="news-slide-content" style="padding: 60px 20px; text-align: center;">
                            <h3 class="news-slide-title">ðŸ“ˆ Mantente informado sobre el mercado</h3>
                            <p class="news-slide-description">Para las Ãºltimas noticias financieras, visita nuestras fuentes recomendadas.</p>
                            <div style="margin-top: 20px;">
                                <a href="https://finance.yahoo.com" target="_blank" class="news-slide-link" style="margin: 5px;">Yahoo Finance</a>
                                <a href="https://www.marketwatch.com" target="_blank" class="news-slide-link" style="margin: 5px;">MarketWatch</a>
                                <a href="https://www.ambito.com" target="_blank" class="news-slide-link" style="margin: 5px;">Ãmbito</a>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Cambiar slide de noticias
        function changeNewsSlide(direction) {
            currentNewsSlide += direction;
            
            if (currentNewsSlide >= newsSlides.length) {
                currentNewsSlide = 0;
            } else if (currentNewsSlide < 0) {
                currentNewsSlide = newsSlides.length - 1;
            }
            
            updateNewsSlider();
        }
        
        // Ir a un slide especÃ­fico
        function goToNewsSlide(index) {
            currentNewsSlide = index;
            updateNewsSlider();
        }
        
        // Actualizar posiciÃ³n del slider
        function updateNewsSlider() {
            const wrapper = document.getElementById('newsSliderWrapper');
            wrapper.style.transform = `translateX(-${currentNewsSlide * 100}%)`;
            
            // Actualizar contador
            document.getElementById('newsCounter').textContent = `${currentNewsSlide + 1}/${newsSlides.length}`;
            
            // Actualizar dots
            document.querySelectorAll('.news-slider-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentNewsSlide);
            });
        }
        
        // Crear indicadores de slide
        function createNewsSliderDots() {
            const dotsContainer = document.getElementById('newsSliderDots');
            dotsContainer.innerHTML = newsSlides.map((_, index) => 
                `<div class="news-slider-dot ${index === 0 ? 'active' : ''}" onclick="goToNewsSlide(${index})"></div>`
            ).join('');
        }
        
        function loadTradingViewWidget(symbol, timeframe) {
            // Limpiar widget anterior
            document.getElementById('tradingview-widget').innerHTML = '';
            
            // Mapear timeframes a TradingView
            const tvTimeframes = {
                '5m': '5', '10m': '10', '15m': '15', '30m': '30', '1h': '60',
                '1d': 'D', '1w': 'W', '1m': 'M', '3m': '3M', '6m': '6M', '1y': '12M'
            };
            
            const tvTimeframe = tvTimeframes[timeframe] || 'D';
            
            try {
                // Crear widget real de TradingView
                new TradingView.widget({
                    "width": "100%",
                    "height": 400,
                    "symbol": symbol,
                    "interval": tvTimeframe,
                    "timezone": "America/New_York",
                    "theme": "dark",
                    "style": "1", // Velas japonesas
                    "locale": "es",
                    "toolbar_bg": "#2c3e50",
                    "enable_publishing": false,
                    "hide_top_toolbar": false,
                    "hide_legend": false,
                    "save_image": false,
                    "container_id": "tradingview-widget",
                    "studies": [
                        "RSI@tv-basicstudies",           // RSI
                        "MACD@tv-basicstudies",          // MACD
                        "MASimple@tv-basicstudies",      // Media MÃ³vil Simple
                        "BB@tv-basicstudies"             // Bandas de Bollinger
                    ],
                    "overrides": {
                        "paneProperties.background": "#2c3e50",
                        "paneProperties.vertGridProperties.color": "#34495e",
                        "paneProperties.horzGridProperties.color": "#34495e",
                        "symbolWatermarkProperties.transparency": 90,
                        "scalesProperties.textColor": "#ecf0f1"
                    },
                    "disabled_features": [
                        "use_localstorage_for_settings",
                        "volume_force_overlay"
                    ],
                    "enabled_features": [
                        "study_templates"
                    ]
                });
                
                console.log(`ðŸ“ˆ Widget de TradingView cargado para ${symbol} (${tvTimeframe})`);
                
            } catch (error) {
                console.error('Error cargando TradingView:', error);
                
                // Fallback si TradingView no estÃ¡ disponible
                const fallbackHTML = `
                    <div style="height: 400px; width: 100%; background: #1e222d; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 15px;">ðŸ“ˆ ${symbol}</div>
                            <div style="font-size: 1em; opacity: 0.8; margin-bottom: 20px;">Marco temporal: ${predictor.getTimeframeName(timeframe)}</div>
                            
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <div style="font-size: 0.9em; margin-bottom: 10px;">ðŸ“Š Indicadores TÃ©cnicos Incluidos:</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8em;">
                                    <div>â€¢ RSI (14)</div>
                                    <div>â€¢ MACD</div>
                                    <div>â€¢ SMA 20/50</div>
                                    <div>â€¢ Bandas Bollinger</div>
                                </div>
                            </div>
                            
                            <div style="font-size: 0.8em; opacity: 0.6; margin-top: 15px;">
                                ðŸ’¡ Para ver el grÃ¡fico interactivo completo,<br>
                                sube la aplicaciÃ³n a un servidor web
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('tradingview-widget').innerHTML = fallbackHTML;
            }
        }
        
        // Inicializar el formulario de predicciÃ³n
        function initPredictionForm() {
            const form = document.getElementById('predictionForm');
            if (!form) {
                console.error('âŒ Formulario de predicciÃ³n no encontrado');
                return;
            }
            
            console.log('âœ… Formulario encontrado, registrando event listener...');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('ðŸ“ Formulario enviado');
                
                const symbol = document.getElementById('stockSymbol').value.toUpperCase().trim();
                const timeframe = document.getElementById('timeframe').value;
                const event = document.getElementById('importantEvent').value.trim();
                
                console.log('ðŸ“Š Datos del formulario:', { symbol, timeframe, event });
                
                if (!symbol) {
                    showError('Por favor ingresa un sÃ­mbolo de acciÃ³n');
                    return;
                }
                
                showLoading();
                console.log('â³ Iniciando predicciÃ³n para:', symbol);
                
                try {
                    const prediction = await predictor.predictStock(symbol, timeframe, event);
                    console.log('âœ… PredicciÃ³n obtenida:', prediction);
                    showResults(prediction);
                    
                    // Auto-resetear el formulario despuÃ©s de mostrar resultados
                    setTimeout(() => {
                        document.getElementById('stockSymbol').value = '';
                        document.getElementById('timeframe').value = '1d';
                        document.getElementById('importantEvent').value = '';
                        document.getElementById('stockSymbol').focus();
                    }, 500);
                    
                } catch (error) {
                    console.error('âŒ Error en predicciÃ³n:', error);
                    showError('Error al obtener datos reales: ' + error.message);
                }
            });
            
            console.log('âœ… Formulario de predicciÃ³n inicializado');
        }
        
        function showResults(prediction) {
            const changeClass = prediction.changePercent >= 0 ? 'positive' : 'negative';
            const changeSign = prediction.changePercent >= 0 ? '+' : '';
            
            const resultsHTML = `
                <div class="result-header">
                    <div class="real-time-indicator">
                        ðŸ”´ LIVE - Basado en Datos Reales
                    </div>
                    <div class="result-symbol">${prediction.symbol}</div>
                    <div style="color: #bdc3c7; font-size: 1.1em;">${prediction.name}</div>
                </div>
                
                <div class="prediction-card">
                    <div style="font-size: 1.1em; margin-bottom: 15px; opacity: 0.9;">
                        ðŸ”® PredicciÃ³n para ${predictor.getTimeframeName(prediction.timeframe)}
                    </div>
                    <div class="prediction-price">$${prediction.predictedPrice.toFixed(2)}</div>
                    <div style="font-size: 1.4em; margin-bottom: 15px;">
                        ${changeSign}${prediction.changePercent.toFixed(3)}% 
                        (${changeSign}$${(prediction.predictedPrice - prediction.currentPrice).toFixed(3)})
                    </div>
                    
                    <div class="confidence-section">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Confianza (Datos Reales)</span>
                            <span>${prediction.confidence.toFixed(1)}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${prediction.confidence}%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-grid">
                    <div class="analysis-item">
                        <div class="analysis-label">Precio Actual (Real)</div>
                        <div class="analysis-value">$${prediction.currentPrice.toFixed(2)}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">Precio Objetivo</div>
                        <div class="analysis-value">$${prediction.predictedPrice.toFixed(2)}</div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">Cambio del DÃ­a</div>
                        <div class="analysis-value" style="color: ${prediction.realData.changePercent >= 0 ? '#27ae60' : '#e74c3c'};">
                            ${prediction.realData.changePercent >= 0 ? '+' : ''}${prediction.realData.changePercent.toFixed(2)}%
                        </div>
                    </div>
                    <div class="analysis-item">
                        <div class="analysis-label">Volumen Real</div>
                        <div class="analysis-value">${typeof prediction.realData.volume === 'number' ? prediction.realData.volume.toLocaleString() : prediction.realData.volume}</div>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <div class="recommendation-badge ${prediction.recommendation.class}">
                        ${prediction.recommendation.action}
                    </div>
                </div>
                
                <div class="technical-analysis-section">
                    <div class="factors-title">ðŸ“Š AnÃ¡lisis TÃ©cnico Detallado</div>
                    <div class="technical-indicators">
                        <div class="indicator-item">
                            <div class="indicator-name">RSI (14)</div>
                            <div class="indicator-value">${predictor.lastTechnicalIndicators?.rsi?.toFixed(1) || 'N/A'}</div>
                            <div class="indicator-signal signal-${predictor.lastTechnicalIndicators?.rsiSignal?.toLowerCase() || 'neutral'}">
                                ${predictor.lastTechnicalIndicators?.rsiSignal || 'N/A'}
                            </div>
                        </div>
                        <div class="indicator-item">
                            <div class="indicator-name">MACD</div>
                            <div class="indicator-value">${predictor.lastTechnicalIndicators?.macdHistogram?.toFixed(3) || 'N/A'}</div>
                            <div class="indicator-signal signal-${predictor.lastTechnicalIndicators?.macdSignalType?.toLowerCase() || 'neutral'}">
                                ${predictor.lastTechnicalIndicators?.macdSignalType || 'N/A'}
                            </div>
                        </div>
                        <div class="indicator-item">
                            <div class="indicator-name">Medias MÃ³viles</div>
                            <div class="indicator-value">SMA20: $${predictor.lastTechnicalIndicators?.sma20?.toFixed(2) || 'N/A'}</div>
                            <div class="indicator-signal signal-${predictor.lastTechnicalIndicators?.maSignal?.toLowerCase() || 'neutral'}">
                                ${predictor.lastTechnicalIndicators?.maSignal || 'N/A'}
                            </div>
                        </div>
                        <div class="indicator-item">
                            <div class="indicator-name">Volumen</div>
                            <div class="indicator-value">${predictor.lastTechnicalIndicators?.volumeRatio?.toFixed(2) || 'N/A'}x</div>
                            <div class="indicator-signal signal-${predictor.lastTechnicalIndicators?.volumeSignal === 'HIGH' ? 'buy' : predictor.lastTechnicalIndicators?.volumeSignal === 'LOW' ? 'sell' : 'neutral'}">
                                ${predictor.lastTechnicalIndicators?.volumeSignal || 'N/A'}
                            </div>
                        </div>
                        <div class="indicator-item">
                            <div class="indicator-name">Bandas Bollinger</div>
                            <div class="indicator-value">$${predictor.lastTechnicalIndicators?.bbMiddle?.toFixed(2) || 'N/A'}</div>
                            <div class="indicator-signal signal-${predictor.lastTechnicalIndicators?.bbSignal?.toLowerCase() || 'neutral'}">
                                ${predictor.lastTechnicalIndicators?.bbSignal || 'N/A'}
                            </div>
                        </div>
                    </div>
                </div>
                
                ${predictor.lastEventAnalysis ? `
                <div class="event-analysis-section">
                    <div class="factors-title">ðŸ“° AnÃ¡lisis de Evento Importante</div>
                    <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Impacto del Evento:</span>
                            <span style="color: ${predictor.lastEventAnalysis.impact === 'POSITIVO' ? '#27ae60' : predictor.lastEventAnalysis.impact === 'NEGATIVO' ? '#e74c3c' : '#95a5a6'}; font-weight: bold;">
                                ${predictor.lastEventAnalysis.impact}
                            </span>
                        </div>
                        <div style="font-size: 0.9em; color: #bdc3c7;">
                            <strong>Razonamiento de la IA:</strong>
                            ${predictor.lastEventAnalysis.reasoning.map(reason => `<div style="margin: 5px 0; padding-left: 10px; border-left: 2px solid #3498db;">â€¢ ${reason}</div>`).join('')}
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div class="ai-analysis-section">
                    <div class="factors-title">ðŸ¤– AnÃ¡lisis Avanzado con IA Gemini</div>
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 12px; margin-top: 15px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 1.1em; font-weight: bold;">ðŸ§  ${prediction.isAIEnhanced ? 'AnÃ¡lisis IA Activado' : 'AnÃ¡lisis IA Simulado'}</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                                Confianza IA: ${prediction.aiAnalysis.confidence}/10
                            </span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.9em; opacity: 0.8;">Sentimiento del Mercado</div>
                                <div style="font-size: 1.3em; font-weight: bold;">${prediction.aiAnalysis.sentiment}/10</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.9em; opacity: 0.8;">AnÃ¡lisis TÃ©cnico IA</div>
                                <div style="font-size: 1.3em; font-weight: bold;">${prediction.aiAnalysis.technicalScore}/10</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.9em; opacity: 0.8;">Impacto de Eventos</div>
                                <div style="font-size: 1.3em; font-weight: bold;">${prediction.aiAnalysis.eventImpact}/10</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.9em; opacity: 0.8;">Nivel de Riesgo</div>
                                <div style="font-size: 1.3em; font-weight: bold;">${prediction.aiAnalysis.riskLevel}/10</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-weight: bold;">DirecciÃ³n Predicha por IA:</span>
                                <span style="background: ${prediction.aiAnalysis.direction === 'ALCISTA' ? '#27ae60' : prediction.aiAnalysis.direction === 'BAJISTA' ? '#e74c3c' : '#95a5a6'}; padding: 4px 12px; border-radius: 15px; font-weight: bold;">
                                    ${prediction.aiAnalysis.direction}
                                </span>
                            </div>
                            <div style="font-size: 0.9em; opacity: 0.9;">
                                <strong>Razonamiento IA:</strong> ${prediction.aiAnalysis.reasoning}
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 0.85em; opacity: 0.8;">
                            ðŸ’¡ ${prediction.isAIEnhanced ? 'Esta predicciÃ³n combina anÃ¡lisis tÃ©cnico tradicional (60%) con inteligencia artificial Gemini (40%) para mayor precisiÃ³n.' : 'PredicciÃ³n basada en anÃ¡lisis tÃ©cnico avanzado con simulaciÃ³n de IA. Para anÃ¡lisis real con Gemini, configura tu API key.'}
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="factors-title">ðŸ“ˆ GrÃ¡fico de Trading (TradingView)</div>
                    <div class="tradingview-widget" id="tradingview-widget">
                        <!-- TradingView Widget se cargarÃ¡ aquÃ­ -->
                    </div>
                </div>
                
                <div class="factors-section">
                    <div class="factors-title">ðŸ§  Resumen del AnÃ¡lisis IA</div>
                    ${prediction.analysis.map(item => `<div class="factor-item">${item}</div>`).join('')}
                </div>
                
                <div class="data-source-info" style="background: ${prediction.realData.isSimulated ? '#fff3cd' : '#e8f5e8'}; color: #2c3e50;">
                    <h4>${prediction.realData.isSimulated ? 'âš ï¸ Fuente de Datos' : 'ðŸ“¡ Fuente de Datos Verificada'}</h4>
                    <p><strong>MÃ©todo:</strong> ${prediction.realData.method}</p>
                    <p><strong>Fuente:</strong> ${prediction.realData.source}</p>
                    <p><strong>Obtenido:</strong> ${new Date(prediction.realData.timestamp).toLocaleString()}</p>
                    <p style="margin-top: 8px; font-size: 0.9em;">
                        ${prediction.realData.isSimulated 
                            ? 'âš ï¸ <strong>IMPORTANTE:</strong> Estos son datos simulados porque las APIs internacionales no tienen informaciÃ³n de esta acciÃ³n. Para precios reales de acciones argentinas, consulta IOL Invertir Online o Bolsar.' 
                            : 'âœ… Esta predicciÃ³n estÃ¡ basada en datos reales del mercado financiero, lo que aumenta significativamente su precisiÃ³n y confiabilidad.'}
                    </p>
                </div>
            `;
            
            // Limpiar interval de mensajes de carga
            if (window.loadingMessageInterval) {
                clearInterval(window.loadingMessageInterval);
            }
            
            const resultsSection = document.getElementById('resultsSection');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingSection = document.getElementById('loadingSection');
            const errorSection = document.getElementById('errorSection');
            
            if (resultsSection) {
                resultsSection.innerHTML = resultsHTML;
                resultsSection.style.display = 'block';
                
                // Scroll suave hacia los resultados
                setTimeout(() => {
                    resultsSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
            }
            
            if (welcomeMessage) welcomeMessage.style.display = 'none';
            if (loadingSection) loadingSection.style.display = 'none';
            if (errorSection) errorSection.style.display = 'none';
            
            // Restaurar botÃ³n a su estado normal
            const btn = document.getElementById('predictBtn');
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“Š Predecir con Datos Reales';
            }
            
            // Cargar widget de TradingView
            loadTradingViewWidget(prediction.symbol, prediction.timeframe);
        }
        
        function showLoading() {
            const loadingSection = document.getElementById('loadingSection');
            const errorSection = document.getElementById('errorSection');
            const resultsSection = document.getElementById('resultsSection');
            const welcomeMessage = document.getElementById('welcomeMessage');
            
            if (loadingSection) loadingSection.style.display = 'block';
            if (errorSection) errorSection.style.display = 'none';
            if (resultsSection) resultsSection.style.display = 'none';
            if (welcomeMessage) welcomeMessage.style.display = 'none';
            
            const btn = document.getElementById('predictBtn');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = 'â³ Analizando...';
            }
            
            // Mensajes animados de progreso
            const loadingMessages = [
                'ðŸ” Buscando ticker en mercados...',
                'ðŸ“¡ Conectando con Yahoo Finance...',
                'ðŸ’¹ Obteniendo datos en tiempo real...',
                'ðŸ§® Calculando indicadores tÃ©cnicos...',
                'ðŸ¤– Analizando con IA Gemini...',
                'ðŸ“Š Generando predicciÃ³n...'
            ];
            
            let messageIndex = 0;
            const loadingStepElement = document.getElementById('loadingStep');
            
            if (loadingStepElement) {
                // Actualizar mensaje cada 800ms
                const messageInterval = setInterval(() => {
                    if (messageIndex < loadingMessages.length) {
                        loadingStepElement.textContent = loadingMessages[messageIndex];
                        messageIndex++;
                    } else {
                        clearInterval(messageInterval);
                    }
                }, 800);
                
                // Guardar el interval para poder limpiarlo despuÃ©s
                window.loadingMessageInterval = messageInterval;
            }
        }
        
        function showError(message) {
            // Limpiar interval de mensajes de carga
            if (window.loadingMessageInterval) {
                clearInterval(window.loadingMessageInterval);
            }
            
            const errorMessage = document.getElementById('errorMessage');
            const errorSection = document.getElementById('errorSection');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingSection = document.getElementById('loadingSection');
            const resultsSection = document.getElementById('resultsSection');
            
            if (errorMessage) errorMessage.textContent = message;
            if (errorSection) errorSection.style.display = 'block';
            if (welcomeMessage) welcomeMessage.style.display = 'none';
            if (loadingSection) loadingSection.style.display = 'none';
            if (resultsSection) resultsSection.style.display = 'none';
            
            const btn = document.getElementById('predictBtn');
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“Š Predecir con Datos Reales';
            }
        }
        
        // FunciÃ³n para animar los valores de mercado (simulaciÃ³n de actualizaciÃ³n)
        function animateMarketValues() {
            const indicators = document.querySelectorAll('.indicator-value');
            indicators.forEach(indicator => {
                // PequeÃ±a animaciÃ³n de parpadeo para simular actualizaciÃ³n
                setInterval(() => {
                    indicator.style.opacity = '0.7';
                    setTimeout(() => {
                        indicator.style.opacity = '1';
                    }, 200);
                }, 5000 + Math.random() * 5000); // Entre 5-10 segundos
            });
        }
        
        // Toggle Black-Scholes Calculator
        function toggleBlackScholes() {
            const calc = document.getElementById('blackScholesCalc');
            if (calc.style.display === 'none') {
                calc.style.display = 'block';
                calc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                calc.style.display = 'none';
            }
        }
        
        // Convertir dÃ­as a aÃ±os automÃ¡ticamente
        function updateYearsFromDays() {
            const days = parseFloat(document.getElementById('bs_days').value);
            if (!isNaN(days) && days > 0) {
                const years = days / 365;
                document.getElementById('bs_years_display').textContent = years.toFixed(4);
            } else {
                document.getElementById('bs_years_display').textContent = '0';
            }
        }
        
        // Black-Scholes Model Implementation (Mejorado)
        function calculateBlackScholes() {
            // Obtener valores
            const S = parseFloat(document.getElementById('bs_spot').value);
            const K = parseFloat(document.getElementById('bs_strike').value);
            const days = parseFloat(document.getElementById('bs_days').value);
            const T = days / 365; // Convertir dÃ­as a aÃ±os
            const sigma = parseFloat(document.getElementById('bs_volatility').value) / 100;
            const r = parseFloat(document.getElementById('bs_rate').value) / 100;
            
            // Precios de mercado (opcionales)
            const marketCall = parseFloat(document.getElementById('bs_market_call').value);
            const marketPut = parseFloat(document.getElementById('bs_market_put').value);
            
            // Validar inputs obligatorios
            if (isNaN(S) || isNaN(K) || isNaN(days) || isNaN(sigma) || isNaN(r)) {
                alert('âš ï¸ Por favor completa todos los campos obligatorios con valores numÃ©ricos vÃ¡lidos');
                return;
            }
            
            if (S <= 0 || K <= 0 || days <= 0 || sigma <= 0) {
                alert('âš ï¸ Los valores deben ser mayores a cero');
                return;
            }
            
            // FunciÃ³n de distribuciÃ³n normal acumulativa (AproximaciÃ³n de Abramowitz y Stegun)
            function normCDF(x) {
                const t = 1 / (1 + 0.2316419 * Math.abs(x));
                const d = 0.3989423 * Math.exp(-x * x / 2);
                const prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
                return x > 0 ? 1 - prob : prob;
            }
            
            // FunciÃ³n de densidad normal estÃ¡ndar
            function normPDF(x) {
                return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
            }
            
            // Calcular d1 y d2 (fÃ³rmulas de Black-Scholes)
            const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            
            // Calcular precios teÃ³ricos de opciones
            const callPrice = S * normCDF(d1) - K * Math.exp(-r * T) * normCDF(d2);
            const putPrice = K * Math.exp(-r * T) * normCDF(-d2) - S * normCDF(-d1);
            
            // Calcular Greeks
            const deltaCall = normCDF(d1);
            const deltaPut = deltaCall - 1;
            const gamma = normPDF(d1) / (S * sigma * Math.sqrt(T));
            const vega = S * normPDF(d1) * Math.sqrt(T) / 100; // Por 1% de cambio en volatilidad
            const thetaCall = -(S * normPDF(d1) * sigma / (2 * Math.sqrt(T))) - r * K * Math.exp(-r * T) * normCDF(d2);
            const thetaPut = -(S * normPDF(d1) * sigma / (2 * Math.sqrt(T))) + r * K * Math.exp(-r * T) * normCDF(-d2);
            
            // Mostrar resultados principales
            document.getElementById('bs_call').textContent = '$' + callPrice.toFixed(4);
            document.getElementById('bs_put').textContent = '$' + putPrice.toFixed(4);
            
            // ComparaciÃ³n con precio de mercado (si se proporcionÃ³)
            const callComparisonDiv = document.getElementById('bs_call_comparison');
            const putComparisonDiv = document.getElementById('bs_put_comparison');
            
            if (!isNaN(marketCall) && marketCall > 0) {
                const callDiff = marketCall - callPrice;
                const callDiffPercent = (callDiff / callPrice) * 100;
                const isExpensive = callDiff > 0;
                
                callComparisonDiv.innerHTML = `
                    <div style="padding: 10px; background: ${isExpensive ? 'rgba(231, 76, 60, 0.2)' : 'rgba(39, 174, 96, 0.2)'}; border-radius: 6px; border-left: 3px solid ${isExpensive ? '#e74c3c' : '#27ae60'};">
                        <div style="font-size: 0.85em; color: #bdc3c7; margin-bottom: 5px;">Precio de Mercado: $${marketCall.toFixed(4)}</div>
                        <div style="font-size: 1em; font-weight: bold; color: ${isExpensive ? '#e74c3c' : '#27ae60'};">
                            ${isExpensive ? 'âš ï¸ CARA' : 'âœ… BARATA'} 
                            (${isExpensive ? '+' : ''}${callDiffPercent.toFixed(2)}%)
                        </div>
                        <div style="font-size: 0.8em; color: #95a5a6; margin-top: 5px;">
                            Diferencia: $${Math.abs(callDiff).toFixed(4)}
                        </div>
                    </div>
                `;
                callComparisonDiv.style.display = 'block';
            } else {
                callComparisonDiv.style.display = 'none';
            }
            
            if (!isNaN(marketPut) && marketPut > 0) {
                const putDiff = marketPut - putPrice;
                const putDiffPercent = (putDiff / putPrice) * 100;
                const isExpensive = putDiff > 0;
                
                putComparisonDiv.innerHTML = `
                    <div style="padding: 10px; background: ${isExpensive ? 'rgba(231, 76, 60, 0.2)' : 'rgba(39, 174, 96, 0.2)'}; border-radius: 6px; border-left: 3px solid ${isExpensive ? '#e74c3c' : '#27ae60'};">
                        <div style="font-size: 0.85em; color: #bdc3c7; margin-bottom: 5px;">Precio de Mercado: $${marketPut.toFixed(4)}</div>
                        <div style="font-size: 1em; font-weight: bold; color: ${isExpensive ? '#e74c3c' : '#27ae60'};">
                            ${isExpensive ? 'âš ï¸ CARA' : 'âœ… BARATA'} 
                            (${isExpensive ? '+' : ''}${putDiffPercent.toFixed(2)}%)
                        </div>
                        <div style="font-size: 0.8em; color: #95a5a6; margin-top: 5px;">
                            Diferencia: $${Math.abs(putDiff).toFixed(4)}
                        </div>
                    </div>
                `;
                putComparisonDiv.style.display = 'block';
            } else {
                putComparisonDiv.style.display = 'none';
            }
            
            // Mostrar Greeks
            document.getElementById('bs_delta_call').textContent = deltaCall.toFixed(4);
            document.getElementById('bs_delta_put').textContent = deltaPut.toFixed(4);
            document.getElementById('bs_gamma').textContent = gamma.toFixed(6);
            document.getElementById('bs_vega').textContent = vega.toFixed(4);
            document.getElementById('bs_theta_call').textContent = (thetaCall / 365).toFixed(4);
            document.getElementById('bs_theta_put').textContent = (thetaPut / 365).toFixed(4);
            
            // Mostrar resultados
            document.getElementById('bs_results').style.display = 'block';
            
            // Scroll suave hacia resultados
            setTimeout(() => {
                document.getElementById('bs_results').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }, 100);
        }
        

        // ========================================
        // SISTEMA DE TEMAS (Dark/Light)
        // ========================================
        
        // Cargar tema guardado o usar oscuro por defecto
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }
        
        // Cambiar tema
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            
            console.log(`ðŸŽ¨ Tema cambiado a: ${newTheme}`);
        }
        
        // Actualizar icono del botÃ³n
        function updateThemeIcon(theme) {
            const themeIcon = document.querySelector('.theme-icon');
            if (themeIcon) {
                themeIcon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
            }
        }
        
        // ========================================
        // SISTEMA DE ACCIONES FAVORITAS
        // ========================================
        const FAVORITES_KEY = 'stockPredictionFavorites';
        
        // Favoritos por defecto con logos
        const defaultFavorites = [
            { symbol: 'AAPL', name: 'Apple Inc.' },
            { symbol: 'TSLA', name: 'Tesla Inc.' },
            { symbol: 'GOOGL', name: 'Alphabet Inc.' },
            { symbol: 'MSFT', name: 'Microsoft Corp.' },
            { symbol: 'GGAL', name: 'Grupo Galicia' },
            { symbol: 'YPF', name: 'YPF S.A.' }
        ];
        
        // Obtener URL del logo de la acciÃ³n
        function getStockLogo(symbol) {
            // Limpiar el sÃ­mbolo (remover .BA, etc)
            const cleanSymbol = symbol.replace('.BA', '').toUpperCase();
            // Usar servicio de logos financieros
            return `https://logo.clearbit.com/${cleanSymbol.toLowerCase()}.com`;
        }
        
        // Cargar favoritos desde localStorage
        function loadFavorites() {
            try {
                const stored = localStorage.getItem(FAVORITES_KEY);
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (e) {
                console.warn('Error cargando favoritos:', e);
            }
            return defaultFavorites;
        }
        
        // Guardar favoritos en localStorage
        function saveFavorites(favorites) {
            try {
                localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            } catch (e) {
                console.error('Error guardando favoritos:', e);
            }
        }
        
        // Obtener icono para acciÃ³n favorita
        function getFavoriteIcon(symbol) {
            const upperSymbol = symbol.toUpperCase();
            
            // Acciones argentinas (ADRs)
            const argentineStocks = ['GGAL', 'YPF', 'BMA', 'SUPV', 'PAM', 'TEO', 'LOMA', 'CEPU', 'TGS', 'EDN'];
            if (argentineStocks.includes(upperSymbol)) {
                return 'ðŸ‡¦ðŸ‡·';
            }
            
            // Acciones brasileÃ±as
            const brazilianStocks = ['VALE', 'PETR', 'ITUB', 'ABEV', 'BBD'];
            if (brazilianStocks.includes(upperSymbol)) {
                return 'ðŸ‡§ðŸ‡·';
            }
            
            // Criptomonedas
            if (upperSymbol.includes('BTC') || upperSymbol === 'BITCOIN') return 'â‚¿';
            if (upperSymbol.includes('ETH') || upperSymbol === 'ETHEREUM') return 'â—†';
            
            // Por defecto, acciones americanas
            return 'ðŸ‡ºðŸ‡¸';
        }
        
        // Renderizar favoritos
        function renderFavorites() {
            const container = document.getElementById('favoritesContainer');
            if (!container) {
                console.warn('âš ï¸ Contenedor de favoritos no encontrado');
                return;
            }
            
            const favorites = loadFavorites();
            
            if (favorites.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.5);">
                        <div style="font-size: 3em; margin-bottom: 10px;">â­</div>
                        <p>No tienes acciones favoritas aÃºn.</p>
                        <p style="font-size: 0.9em; margin-top: 5px;">Haz click en "+ AGREGAR" para aÃ±adir tus favoritas.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = favorites.map((fav, index) => `
                <div class="favorite-stock-card" onclick="selectFavoriteStock('${fav.symbol}')">
                    <button class="favorite-delete-btn" onclick="event.stopPropagation(); deleteFavorite(${index})" title="Eliminar">Ã—</button>
                    <div style="font-size: 2.5em; margin-bottom: 12px; filter: drop-shadow(0 0 8px rgba(102, 126, 234, 0.6));">${getFavoriteIcon(fav.symbol)}</div>
                    <div style="font-size: 1.1em; font-weight: 700; color: #ffffff; margin-bottom: 5px; text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);">${fav.symbol}</div>
                    <div style="font-size: 0.75em; color: rgba(255, 255, 255, 0.7);">${fav.name}</div>
                </div>
            `).join('');
            
            console.log('âœ… Favoritos renderizados:', favorites.length);
        }
        
        // Seleccionar acciÃ³n favorita
        function selectFavoriteStock(symbol) {
            const input = document.getElementById('stockSymbol');
            const sidebar = document.getElementById('sidebar');
            
            if (input) {
                input.value = symbol;
                input.focus();
            }
            
            // Scroll suave hacia el formulario
            if (sidebar) {
                sidebar.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
        }
        
        // Mostrar modal para agregar favorito
        function showAddFavoriteModal() {
            const modal = document.getElementById('addFavoriteModal');
            const symbolInput = document.getElementById('favoriteSymbol');
            
            if (modal) {
                modal.style.display = 'flex';
                if (symbolInput) symbolInput.focus();
            }
        }
        
        // Cerrar modal
        function closeAddFavoriteModal() {
            const modal = document.getElementById('addFavoriteModal');
            const symbolInput = document.getElementById('favoriteSymbol');
            const nameInput = document.getElementById('favoriteName');
            
            if (modal) modal.style.display = 'none';
            if (symbolInput) symbolInput.value = '';
            if (nameInput) nameInput.value = '';
        }
        
        // Agregar acciÃ³n favorita
        function addFavoriteStock() {
            const symbolInput = document.getElementById('favoriteSymbol');
            const nameInput = document.getElementById('favoriteName');
            
            if (!symbolInput || !nameInput) {
                console.error('âŒ Inputs del modal no encontrados');
                return;
            }
            
            const symbol = symbolInput.value.trim().toUpperCase();
            const name = nameInput.value.trim();
            
            if (!symbol) {
                alert('âš ï¸ Por favor ingresa un sÃ­mbolo bursÃ¡til');
                return;
            }
            
            if (!name) {
                alert('âš ï¸ Por favor ingresa el nombre de la compaÃ±Ã­a');
                return;
            }
            
            const favorites = loadFavorites();
            
            // Verificar si ya existe
            if (favorites.some(fav => fav.symbol === symbol)) {
                alert('âš ï¸ Esta acciÃ³n ya estÃ¡ en tus favoritos');
                return;
            }
            
            // Agregar nuevo favorito
            favorites.push({ symbol, name });
            saveFavorites(favorites);
            renderFavorites();
            closeAddFavoriteModal();
            
            console.log('âœ… Favorito agregado:', symbol);
        }
        
        // Eliminar favorito
        function deleteFavorite(index) {
            if (!confirm('Â¿EstÃ¡s seguro de eliminar esta acciÃ³n de tus favoritos?')) {
                return;
            }
            
            const favorites = loadFavorites();
            const deleted = favorites.splice(index, 1);
            saveFavorites(favorites);
            renderFavorites();
            
            console.log('ðŸ—‘ï¸ Favorito eliminado:', deleted[0]?.symbol);
        }
        
        // Inicializar event listeners para el modal
        function initFavoritesEventListeners() {
            // Cerrar modal al hacer click fuera
            document.addEventListener('click', (e) => {
                const modal = document.getElementById('addFavoriteModal');
                if (modal && e.target === modal) {
                    closeAddFavoriteModal();
                }
            });
            
            // Cerrar modal con tecla ESC y agregar con Enter
            document.addEventListener('keydown', (e) => {
                const modal = document.getElementById('addFavoriteModal');
                if (modal && modal.style.display === 'flex') {
                    if (e.key === 'Escape') {
                        closeAddFavoriteModal();
                    } else if (e.key === 'Enter') {
                        addFavoriteStock();
                    }
                }
            });
            
            console.log('âœ… Event listeners de favoritos inicializados');
        }
        
        // Inicializar Carrusel de Mercados
        function initMarketsCarousel() {
            const marketsData = [
                // Ãndices
                { icon: 'ðŸ‡ºðŸ‡¸', name: 'S&P 500', value: '4,783.45', change: '+0.85%', positive: true, label: 'Ãndice USA' },
                { icon: 'ðŸ‡ºðŸ‡¸', name: 'NASDAQ', value: '15,011.35', change: '+1.24%', positive: true, label: 'Tech USA' },
                { icon: 'ðŸ‡ºðŸ‡¸', name: 'DOW JONES', value: '37,545.33', change: '+0.52%', positive: true, label: 'Industrial USA' },
                { icon: 'ðŸ‡¦ðŸ‡·', name: 'MERVAL', value: '1,245,890', change: '-0.35%', positive: false, label: 'Argentina' },
                { icon: 'ðŸ‡§ðŸ‡·', name: 'BOVESPA', value: '128,456', change: '+0.68%', positive: true, label: 'Brasil' },
                
                // Criptomonedas
                { icon: 'â‚¿', name: 'BITCOIN', value: '$43,250', change: '+2.15%', positive: true, label: 'Cripto' },
                { icon: 'âŸ ', name: 'ETHEREUM', value: '$2,285', change: '+1.85%', positive: true, label: 'Cripto' },
                
                // Forex
                { icon: 'USD', name: 'DÃ³lar Blue', value: '$1,185', change: '+0.25%', positive: true, label: 'ARS' },
                { icon: 'USD', name: 'DÃ³lar Oficial', value: '$890', change: '+0.15%', positive: true, label: 'ARS' },
                { icon: 'ðŸ‡ªðŸ‡º', name: 'EUR/USD', value: '1.0850', change: '+0.15%', positive: true, label: 'Forex' },
                
                // Commodities
                { icon: 'ðŸ¥‡', name: 'ORO', value: '$2,045', change: '+0.35%', positive: true, label: 'USD/oz' },
                { icon: 'ðŸ›¢ï¸', name: 'PETRÃ“LEO WTI', value: '$78.50', change: '-0.85%', positive: false, label: 'USD/barril' },
                
                // Indicadores Argentina
                { icon: 'ðŸ“‰', name: 'Riesgo PaÃ­s', value: '1,450', change: '-2.5%', positive: true, label: 'Puntos' },
                { icon: 'ðŸ¦', name: 'Tasa BCRA', value: '100%', change: '0%', positive: false, label: 'Anual' },
                
                // Acciones destacadas
                { icon: 'ðŸŽ', name: 'APPLE', value: '$185.92', change: '+1.15%', positive: true, label: 'AAPL' },
                { icon: 'ðŸ”', name: 'GOOGLE', value: '$141.80', change: '+1.42%', positive: true, label: 'GOOGL' },
                { icon: 'âš¡', name: 'TESLA', value: '$248.48', change: '+2.35%', positive: true, label: 'TSLA' },
                { icon: 'ðŸ’»', name: 'MICROSOFT', value: '$378.91', change: '+0.87%', positive: true, label: 'MSFT' }
            ];
            
            // Duplicar para efecto infinito
            const carouselHTML = [...marketsData, ...marketsData].map(item => `
                <div class="market-card">
                    <div class="market-card-icon">${item.icon}</div>
                    <div class="market-card-name">${item.name}</div>
                    <div class="market-card-value">${item.value}</div>
                    <div class="market-card-change ${item.positive ? 'positive' : 'negative'}">
                        ${item.change}
                    </div>
                    <div class="market-card-label">${item.label}</div>
                </div>
            `).join('');
            
            document.getElementById('marketsCarousel').innerHTML = carouselHTML;
        }
        
        // Inicializar Ticker Banner
        function initTickerBanner() {
            const tickerData = [
                // Ãndices principales
                { symbol: 'S&P 500', price: '4,783.45', change: '+0.85%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'NASDAQ', price: '15,011.35', change: '+1.24%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'DOW JONES', price: '37,545.33', change: '+0.52%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'MERVAL', price: '1,245,890', change: '-0.35%', positive: false, icon: 'ðŸ‡¦ðŸ‡·' },
                { symbol: 'BOVESPA', price: '128,456', change: '+0.68%', positive: true, icon: 'ðŸ‡§ðŸ‡·' },
                
                // Acciones USA populares
                { symbol: 'AAPL', price: '185.92', change: '+1.15%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'MSFT', price: '378.91', change: '+0.87%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'GOOGL', price: '141.80', change: '+1.42%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'TSLA', price: '248.48', change: '+2.35%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'AMZN', price: '151.94', change: '+0.95%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'META', price: '353.96', change: '+1.28%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                { symbol: 'NVDA', price: '495.22', change: '+3.15%', positive: true, icon: 'ðŸ‡ºðŸ‡¸' },
                
                // ADRs Argentinos
                { symbol: 'GGAL', price: '32.45', change: '+2.15%', positive: true, icon: 'ðŸ‡¦ðŸ‡·' },
                { symbol: 'YPF', price: '18.90', change: '-1.25%', positive: false, icon: 'ðŸ‡¦ðŸ‡·' },
                { symbol: 'BMA', price: '28.75', change: '+1.85%', positive: true, icon: 'ðŸ‡¦ðŸ‡·' },
                { symbol: 'SUPV', price: '4.82', change: '+0.95%', positive: true, icon: 'ðŸ‡¦ðŸ‡·' },
                { symbol: 'PAM', price: '22.15', change: '-0.45%', positive: false, icon: 'ðŸ‡¦ðŸ‡·' },
                
                // Criptomonedas
                { symbol: 'BTC', price: '43,250', change: '+2.15%', positive: true, icon: 'â‚¿' },
                { symbol: 'ETH', price: '2,285', change: '+1.85%', positive: true, icon: 'â—†' },
                
                // Commodities
                { symbol: 'GOLD', price: '2,045', change: '+0.35%', positive: true, icon: 'ðŸ¥‡' },
                { symbol: 'OIL', price: '78.50', change: '-0.85%', positive: false, icon: 'ðŸ›¢ï¸' },
                
                // Forex
                { symbol: 'EUR/USD', price: '1.0850', change: '+0.15%', positive: true, icon: 'ðŸ‡ªðŸ‡º' },
                { symbol: 'USD/ARS', price: '890.00', change: '+0.25%', positive: true, icon: 'ðŸ’µ' },
                { symbol: 'DÃ³lar Blue', price: '1,050.00', change: '+1.50%', positive: true, icon: 'ðŸ’µ' }
            ];
            
            // Duplicar para efecto infinito
            const tickerHTML = [...tickerData, ...tickerData].map(item => `
                <div class="ticker-item">
                    <span class="ticker-icon">${item.icon}</span>
                    <span class="ticker-symbol">${item.symbol}</span>
                    <span class="ticker-price">$${item.price}</span>
                    <span class="ticker-change ${item.positive ? 'positive' : 'negative'}">
                        ${item.change}
                    </span>
                </div>
            `).join('');
            
            document.getElementById('tickerWrapper').innerHTML = tickerHTML;
        }
        
        // Redimensionamiento de columnas
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (!resizer || !sidebar) return;
            
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;
            
            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = sidebar.offsetWidth;
                resizer.classList.add('resizing');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                const diff = e.clientX - startX;
                const newWidth = startWidth + diff;
                const containerWidth = document.querySelector('.main-container').offsetWidth;
                
                // LÃ­mites: mÃ­nimo 300px, mÃ¡ximo 80% del contenedor
                const minWidth = 300;
                const maxWidth = containerWidth * 0.8;
                
                if (newWidth >= minWidth && newWidth <= maxWidth) {
                    sidebar.style.width = newWidth + 'px';
                    sidebar.style.flexBasis = newWidth + 'px';
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizer.classList.remove('resizing');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        }
        
        console.log('ðŸ“ˆ Stock Prediction AI - VersiÃ³n Final con Datos Reales cargada');
        console.log('ðŸ”´ LIVE - Integrado con APIs financieras reales');
        
        // Esperar a que el DOM estÃ© completamente cargado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        function initializeApp() {
            console.log('ðŸš€ Inicializando aplicaciÃ³n...');
            
            // Cargar tema guardado
            loadTheme();
            
            // Inicializar componentes
            initTickerBanner();
            initMarketsCarousel();
            initResizer();
            loadFinancialNews();
            renderFavorites();
            initFavoritesEventListeners();
            initPredictionForm();
            
            // Animar indicadores de mercado
            setTimeout(() => {
                animateMarketValues();
            }, 2000);
            
            console.log('âœ… AplicaciÃ³n inicializada correctamente');
        }
    </script>
</body>
</html>